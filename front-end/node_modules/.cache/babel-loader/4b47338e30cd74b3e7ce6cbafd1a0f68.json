{"ast":null,"code":"var _jsxFileName = \"C:\\\\aria\\\\cicc-app\\\\front-end\\\\src\\\\components\\\\bell\\\\PendingBell.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { Form, FormGroup, Label, ListGroup, ListGroupItem, // Badge,\nDropdown, DropdownToggle, DropdownMenu, Modal, ModalBody, ModalHeader, Col } from 'reactstrap';\nimport axios from 'axios';\nimport axiosRetry from 'axios-retry';\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\nimport { getRetryConfig } from \"axios/AxiosUtils\";\nimport { isAdmin, isSubgerente, isComandoFiscal } from 'common/SessionUtils';\nimport { TbSquareCheck } from 'react-icons/tb';\nimport readNotificationPendingJobs from \"axios/ReadNotificationPendingJobs\";\nimport { ViewsContext } from 'context/ViewsContext';\nimport { isEmpty } from 'common/utils/collections';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function NotificationBell() {\n  _s();\n\n  const [notificationIndex, setNotificationIndex] = React.useState([]);\n  const [modal, setModal] = React.useState(false);\n  const [notificationOpen, setNotificationOpen] = React.useState(false);\n  const [notifications, setNotifications] = React.useState([]);\n  const {\n    pendingNewNotifications,\n    setPendingNewNotifications\n  } = React.useContext(ViewsContext);\n  const {\n    readNotificationPendingJobsRequest\n  } = readNotificationPendingJobs();\n\n  const toggleModal = () => setModal(!modal);\n\n  const toggleNotification = () => {\n    setNotificationOpen(prevState => !prevState);\n  };\n\n  const axiosRetryProxy = axios.create(getTimeoutConfig());\n  axiosRetry(axiosRetryProxy, getRetryConfig());\n  let ADMIN = isAdmin();\n  let SUBGERENTE = isSubgerente();\n  let COMANDO_FISCAL = isComandoFiscal();\n\n  function markNotificationsAsViewed() {\n    const updatedNotifications = notifications.map(notification => {\n      return { ...notification,\n        visto: true\n      };\n    });\n    setNotifications(updatedNotifications);\n  }\n\n  const ONLY_UNSEEN_NOTIFICATIONS = notifications.filter(notification => {\n    return !notification.visto;\n  });\n  React.useEffect(() => {\n    if (!notificationOpen) {\n      markNotificationsAsViewed();\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [notificationOpen]);\n  React.useEffect(() => {\n    if (pendingNewNotifications) {\n      let pendingNotifications = readNotificationPendingJobsRequest();\n      pendingNotifications.then(res => {\n        if (!isEmpty(res)) {\n          setNotifications(res);\n        }\n      });\n      setPendingNewNotifications(false);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [pendingNewNotifications]);\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      let pendingNotifications = readNotificationPendingJobsRequest();\n      pendingNotifications.then(res => {\n        if (!isEmpty(res)) {\n          setNotifications(res);\n        }\n      });\n    }, 10 * 60000);\n    return () => {\n      clearInterval(interval);\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps  \n  }, []);\n\n  const definePendingType = notification => {\n    let homologationPending = !notification['fiscal_action_homologation_date'];\n    let awarenessPeding = !notification['fiscal_notification_awareness_date'];\n    let supervisionPending = !notification['fiscal_action_supervision_date'];\n    let label = [];\n\n    if (awarenessPeding) {\n      label.push(\"Ciência\");\n    }\n\n    if (supervisionPending) {\n      label.push(\"Supervisão\");\n    }\n\n    if (homologationPending) {\n      label.push(\"Homologação\");\n    }\n\n    if (label.length > 0) {\n      //este pequeno código abaixo tem o objetivo de fazer com que a mensagem fique bonita, trocando a última virgula pelo \"e\"\n      let result = label.join(\", \");\n      var currentIndex = result.lastIndexOf(\",\");\n      result = result.substring(0, currentIndex) + \" e\" + result.substring(currentIndex + 1, result.length);\n    } else if (COMANDO_FISCAL) {\n      return 'Preenchimento de relatório de ação fiscal.';\n    }\n  };\n\n  let visibility = ADMIN || SUBGERENTE || COMANDO_FISCAL ? true : false;\n  return visibility ? /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Dropdown, {\n      isOpen: notificationOpen,\n      toggle: toggleNotification,\n      nav: true,\n      id: \"dropdown-bell\",\n      children: [/*#__PURE__*/_jsxDEV(DropdownToggle, {\n        nav: true,\n        onClick: e => {\n          e.preventDefault();\n        },\n        \"aria-expanded\": notificationOpen,\n        children: [/*#__PURE__*/_jsxDEV(TbSquareCheck, {\n          style: {\n            fontSize: '20px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontWeight: 'bold',\n            position: 'absolute',\n            top: '40%'\n          },\n          children: ONLY_UNSEEN_NOTIFICATIONS.length\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DropdownMenu, {\n        className: \"dropdown-navbar\",\n        right: true,\n        tag: \"ul\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            maxHeight: '300px',\n            minHeight: '100px',\n            width: '250px',\n            overflowY: 'auto'\n          },\n          children: ONLY_UNSEEN_NOTIFICATIONS.length > 0 ? /*#__PURE__*/_jsxDEV(ListGroup, {\n            className: \"notification-list\",\n            children: ONLY_UNSEEN_NOTIFICATIONS.map((notification, i) => {\n              return /*#__PURE__*/_jsxDEV(ListGroupItem, {\n                onClick: () => {\n                  setNotificationIndex(i);\n                  setModal(!modal);\n                },\n                className: \"justify-content-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: notification['nome']\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 167,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 23\n                }, this), new Date(notification['evento_infevento_dhregpassagem']).toLocaleString('pt-BR')]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 21\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 'small',\n              color: '#555555',\n              textAlign: 'center',\n              position: 'absolute',\n              top: '30%',\n              left: '10%'\n            },\n            children: \"Nenhuma notifica\\xE7\\xE3o pendente!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: modal,\n      toggle: toggleModal,\n      children: [/*#__PURE__*/_jsxDEV(ModalHeader, {\n        toggle: toggleModal,\n        children: \"Detalhes da Notifica\\xE7\\xE3o\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(ModalBody, {\n        style: {\n          justifyContent: 'center',\n          alignContent: 'center',\n          display: 'flex'\n        },\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          style: {\n            padding: '1.5rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(FormGroup, {\n            row: true,\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              for: \"exampleEmail\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Ocorr\\xEAncia: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 188,\n                columnNumber: 35\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              sm: 12,\n              children: /*#__PURE__*/_jsxDEV(Label, {\n                children: modal && notifications[notificationIndex]['id']\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n            row: true,\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              for: \"exampleEmail\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Nome:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 35\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              sm: 12,\n              children: /*#__PURE__*/_jsxDEV(Label, {\n                children: modal && notifications[notificationIndex]['nome']\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 199,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n            row: true,\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              for: \"exampleEmail\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Data do Disparo:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 206,\n                columnNumber: 35\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              sm: 12,\n              children: /*#__PURE__*/_jsxDEV(Label, {\n                children: modal && /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: new Date(notifications[notificationIndex]['fiscal_notification_date']).toLocaleString('pt-BR')\n                }, void 0, false)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 208,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 207,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n            row: true,\n            children: [/*#__PURE__*/_jsxDEV(Label, {\n              for: \"exampleEmail\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Pend\\xEAncia:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 215,\n                columnNumber: 35\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 215,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              sm: 12,\n              children: /*#__PURE__*/_jsxDEV(Label, {\n                children: modal && definePendingType(notifications[notificationIndex])\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 217,\n                columnNumber: 11\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 9\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 3\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n}\n\n_s(NotificationBell, \"ib74MI+5zn5q0Uq7IMU3m3PRtX8=\");\n\n_c = NotificationBell;\n\nvar _c;\n\n$RefreshReg$(_c, \"NotificationBell\");","map":{"version":3,"sources":["C:/aria/cicc-app/front-end/src/components/bell/PendingBell.js"],"names":["React","Form","FormGroup","Label","ListGroup","ListGroupItem","Dropdown","DropdownToggle","DropdownMenu","Modal","ModalBody","ModalHeader","Col","axios","axiosRetry","getTimeoutConfig","getRetryConfig","isAdmin","isSubgerente","isComandoFiscal","TbSquareCheck","readNotificationPendingJobs","ViewsContext","isEmpty","NotificationBell","notificationIndex","setNotificationIndex","useState","modal","setModal","notificationOpen","setNotificationOpen","notifications","setNotifications","pendingNewNotifications","setPendingNewNotifications","useContext","readNotificationPendingJobsRequest","toggleModal","toggleNotification","prevState","axiosRetryProxy","create","ADMIN","SUBGERENTE","COMANDO_FISCAL","markNotificationsAsViewed","updatedNotifications","map","notification","visto","ONLY_UNSEEN_NOTIFICATIONS","filter","useEffect","pendingNotifications","then","res","interval","setInterval","clearInterval","definePendingType","homologationPending","awarenessPeding","supervisionPending","label","push","length","result","join","currentIndex","lastIndexOf","substring","visibility","e","preventDefault","fontSize","fontWeight","position","top","maxHeight","minHeight","width","overflowY","i","Date","toLocaleString","color","textAlign","left","justifyContent","alignContent","display","padding"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport {\r\n  Form,\r\n  FormGroup,\r\n  Label,\r\n  ListGroup,\r\n  ListGroupItem,\r\n  // Badge,\r\n  Dropdown,\r\n  DropdownToggle,\r\n  DropdownMenu,\r\n  Modal,\r\n  ModalBody,\r\n  ModalHeader,\r\n  Col\r\n} from 'reactstrap';\r\nimport axios from 'axios';\r\nimport axiosRetry from 'axios-retry';\r\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\r\nimport { getRetryConfig } from \"axios/AxiosUtils\";\r\nimport { isAdmin, isSubgerente, isComandoFiscal } from 'common/SessionUtils';\r\nimport { TbSquareCheck } from 'react-icons/tb';\r\n\r\nimport readNotificationPendingJobs from \"axios/ReadNotificationPendingJobs\";\r\n\r\nimport { ViewsContext } from 'context/ViewsContext';\r\nimport { isEmpty } from 'common/utils/collections';\r\n\r\nexport default function NotificationBell() {\r\n  \r\n  const [notificationIndex, setNotificationIndex] = React.useState([])\r\n  const [modal, setModal] = React.useState(false);\r\n  const [notificationOpen, setNotificationOpen] = React.useState(false)\r\n  const [notifications, setNotifications] = React.useState([]);\r\n  const { pendingNewNotifications, setPendingNewNotifications } = React.useContext(ViewsContext);\r\n  const { readNotificationPendingJobsRequest } = readNotificationPendingJobs()\r\n  \r\n  const toggleModal = () => setModal(!modal)\r\n  const toggleNotification = () => {setNotificationOpen((prevState) => !prevState);};\r\n  \r\n\r\n  const axiosRetryProxy = axios.create(getTimeoutConfig())\r\n  axiosRetry(axiosRetryProxy, getRetryConfig())\r\n\r\n  let ADMIN = isAdmin();\r\n  let SUBGERENTE = isSubgerente();\r\n  let COMANDO_FISCAL = isComandoFiscal();\r\n\r\n  function markNotificationsAsViewed() {\r\n    const updatedNotifications = notifications.map((notification) => {\r\n      return { ...notification, visto: true };\r\n    });\r\n    setNotifications(updatedNotifications);\r\n  }\r\n\r\n  const ONLY_UNSEEN_NOTIFICATIONS = notifications.filter(notification => {\r\n    return !notification.visto\r\n  })\r\n\r\n  React.useEffect(() => {\r\n\r\n    if(!notificationOpen){\r\n      markNotificationsAsViewed();\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [notificationOpen])\r\n\r\n\r\n  React.useEffect(() => {\r\n    if (pendingNewNotifications) {\r\n      let pendingNotifications = readNotificationPendingJobsRequest()\r\n\r\n      pendingNotifications.then(res => {\r\n        if(!isEmpty(res)) {\r\n          setNotifications(res);\r\n        }\r\n      }\r\n      )\r\n\r\n      setPendingNewNotifications(false);\r\n    }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [pendingNewNotifications])\r\n\r\n  React.useEffect(() => {\r\n    \r\n      const interval = setInterval(() => {\r\n      let pendingNotifications = readNotificationPendingJobsRequest();\r\n\r\n      pendingNotifications.then(res => {\r\n        if(!isEmpty(res)) {\r\n          setNotifications(res);\r\n        }\r\n      })\r\n      \r\n    }, 10 * 60000);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n    };\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps  \r\n  }, []);\r\n\r\n  const definePendingType = (notification) => {\r\n    let homologationPending = !notification['fiscal_action_homologation_date']\r\n    let awarenessPeding = !notification['fiscal_notification_awareness_date']\r\n    let supervisionPending = !notification['fiscal_action_supervision_date']\r\n    \r\n    let label = []\r\n\r\n    if(awarenessPeding) {\r\n      label.push(\"Ciência\")\r\n    } \r\n\r\n    if(supervisionPending) {\r\n      label.push(\"Supervisão\")\r\n    } \r\n    \r\n    if(homologationPending) {\r\n      label.push(\"Homologação\")\r\n    } \r\n\r\n    \r\n    if (label.length > 0) {\r\n      //este pequeno código abaixo tem o objetivo de fazer com que a mensagem fique bonita, trocando a última virgula pelo \"e\"\r\n      let result = label.join(\", \")\r\n      var currentIndex = result.lastIndexOf(\",\");\r\n      result = result.substring(0, currentIndex) + \" e\" + result.substring(currentIndex + 1, result.length)\r\n    } else if(COMANDO_FISCAL) {\r\n      return 'Preenchimento de relatório de ação fiscal.'\r\n    }\r\n\r\n  }\r\n  \r\n  let visibility = (ADMIN || SUBGERENTE || COMANDO_FISCAL) ? true : false;\r\n\r\n  return (\r\n    visibility ?\r\n      <>\r\n        <Dropdown isOpen={notificationOpen} toggle={toggleNotification} nav id='dropdown-bell'>\r\n        <DropdownToggle\r\n          nav\r\n          onClick={(e) => {e.preventDefault()}}\r\n          aria-expanded={notificationOpen}\r\n        >\r\n          <TbSquareCheck style={{ fontSize: '20px' }} />\r\n          <span style={{ fontWeight: 'bold', position: 'absolute', top: '40%' }}> \r\n            {ONLY_UNSEEN_NOTIFICATIONS.length}\r\n          </span>\r\n        </DropdownToggle>\r\n\r\n        <DropdownMenu className=\"dropdown-navbar\" right tag=\"ul\">\r\n          <div style={{ maxHeight: '300px', minHeight: '100px', width: '250px', overflowY: 'auto' }}>\r\n            {ONLY_UNSEEN_NOTIFICATIONS.length > 0 ? (\r\n              <ListGroup className=\"notification-list\">\r\n                {ONLY_UNSEEN_NOTIFICATIONS.map((notification, i) => {\r\n                  return (\r\n                    <ListGroupItem\r\n                      key={i}\r\n                      onClick={() => {\r\n                        setNotificationIndex(i);\r\n                        setModal(!modal);\r\n                      }}\r\n                      className=\"justify-content-between\"\r\n                    >\r\n                      <b>{notification['nome']}</b>\r\n                      <br />\r\n                      {new Date(notification['evento_infevento_dhregpassagem']).toLocaleString('pt-BR')}\r\n                    </ListGroupItem>\r\n                  );\r\n                })}\r\n              </ListGroup>\r\n            ) : (\r\n              <div style={{ fontSize: 'small', color: '#555555', textAlign: 'center', position: 'absolute', top: '30%', left: '10%' }}>\r\n                Nenhuma notificação pendente!\r\n              </div>\r\n            )}\r\n          </div>\r\n        </DropdownMenu>\r\n      </Dropdown>\r\n\r\n      <Modal isOpen={modal} toggle={toggleModal}>\r\n  <ModalHeader toggle={toggleModal}>Detalhes da Notificação</ModalHeader>\r\n  <ModalBody style={{ justifyContent: 'center', alignContent: 'center', display: 'flex' }}>\r\n    <Form style={{padding:'1.5rem'}}>\r\n      <FormGroup row>\r\n        <Label for=\"exampleEmail\"><b>Ocorrência: </b></Label>\r\n        <Col sm={12}>\r\n          <Label>\r\n            {modal && notifications[notificationIndex]['id']}\r\n          </Label>\r\n        </Col>\r\n      </FormGroup>\r\n\r\n      <FormGroup row>\r\n        <Label for=\"exampleEmail\"><b>Nome:</b></Label>\r\n        <Col sm={12}>\r\n          <Label>\r\n            {modal && notifications[notificationIndex]['nome']}\r\n          </Label>\r\n        </Col>\r\n      </FormGroup>\r\n\r\n      <FormGroup row>\r\n        <Label for=\"exampleEmail\"><b>Data do Disparo:</b></Label>\r\n        <Col sm={12}>\r\n          <Label>\r\n            {modal && <>{new Date(notifications[notificationIndex]['fiscal_notification_date']).toLocaleString('pt-BR')}</>}\r\n          </Label>\r\n        </Col>\r\n      </FormGroup>\r\n      \r\n      <FormGroup row>\r\n        <Label for=\"exampleEmail\"><b>Pendência:</b></Label>\r\n        <Col sm={12}>\r\n          <Label>\r\n            {modal && definePendingType(notifications[notificationIndex])}\r\n          </Label>\r\n        </Col>\r\n      </FormGroup>\r\n\r\n      \r\n    </Form>\r\n  </ModalBody>\r\n</Modal>\r\n      </>\r\n      :\r\n      <></>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}