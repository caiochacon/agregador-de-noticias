{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rodri\\\\OneDrive\\\\Documentos\\\\cicc-app\\\\front-end\\\\src\\\\components\\\\tables\\\\Table.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport axios from \"axios\";\nimport fetch from 'node-fetch';\nimport Pagination from \"./Pagination\";\nimport { isAdmin } from 'common/SessionUtils';\nimport env from 'common/enviroment';\nimport axiosRetry from 'axios-retry';\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\nimport { getRetryConfig } from \"axios/AxiosUtils\";\nimport { useAbortController } from 'common/hooks/useAbortController';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { createElement as _createElement } from \"react\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction emptyFunction(value) {\n  return value;\n}\n\n;\nexport default function Table(props) {\n  _s();\n\n  var _tableRef$current;\n\n  const isMounted = React.useRef(true);\n  const [data, setData] = React.useState([]);\n  const tableData = props.data || data;\n  const pageSize = props.pageSize || 10;\n  const [index, setIndex] = React.useState(0);\n  const [maxIndex, setMaxIndex] = React.useState(props.data ? Math.ceil(tableData.length / pageSize) : -1);\n  const [isLoading, setIsloading] = props.loading || [null, () => {}];\n  const columnsNames = Object.keys(props.columns).filter(columnName => props.columns[columnName].adminOnly ? isAdmin() : true);\n  const refresh = props.refresh;\n  const tags = props.tags;\n  const invalid = props.invalid || [null, undefined];\n  const requestMiddleware = props.requestMiddleware || emptyFunction;\n\n  const trProps = props.trProps || (() => {});\n\n  const hideTopBar = props.hideTopBar || false;\n  const dummyRef = React.useRef();\n  const containerRef = React.useRef();\n  const tableRef = React.useRef();\n  const configAxios = axios.create(getTimeoutConfig());\n  axiosRetry(configAxios, getRetryConfig());\n  const {\n    getSignal,\n    abortAll\n  } = useAbortController();\n\n  const delay = ms => new Promise(resolve => setTimeout(() => resolve(), ms));\n\n  const retryFetch = function (url) {\n    let fetchOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let retries = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 3;\n    let retryDelay = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1000;\n    let timeout = arguments.length > 4 ? arguments[4] : undefined;\n    return new Promise((resolve, reject) => {\n      // check for timeout\n      if (timeout) setTimeout(() => reject('error: timeout'), timeout);\n\n      const wrapper = n => {\n        fetch(url, fetchOptions).then(res => resolve(res)).catch(async err => {\n          if (n > 0) {\n            await delay(retryDelay);\n            wrapper(--n);\n          } else {\n            reject(err);\n          }\n        });\n      };\n\n      wrapper(retries);\n    });\n  };\n\n  const handleScroll = e => {\n    if (e.target === dummyRef.current && containerRef.current) {\n      containerRef.current.scrollLeft = e.target.scrollLeft;\n    } else if (e.target === containerRef.current && dummyRef.current) {\n      dummyRef.current.scrollLeft = e.target.scrollLeft;\n    }\n  };\n\n  React.useEffect(() => {\n    return () => {\n      isMounted.current = false;\n    };\n  }, []);\n  React.useEffect(() => {\n    setIndex(0);\n    setMaxIndex(-1);\n\n    if (props.countUrl && props.countRequestBody) {\n      let body = props.countRequestBody();\n      configAxios.post(\"\".concat(env.apiAddress).concat(props.countUrl), body).then(res => {\n        if (res.data[0] && res.data[0]['aggregate']) {\n          setMaxIndex(Math.ceil(res.data[0]['aggregate']['count'] / pageSize) - 1);\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [tags]);\n  React.useEffect(() => {\n    // Request data\n    if (props.dataUrl && props.requestBody) {\n      const fetchApi = async () => {\n        try {\n          setIsloading(true);\n          /*const res = await fetch(`${env.apiAddress}${props.dataUrl}?page=${index + 1}&page_size=${pageSize}`, {\r\n            method: 'post',\r\n            body: JSON.stringify(props.requestBody()),\r\n            headers: { 'Content-Type': 'application/json' }\r\n          })*/\n\n          const res = await retryFetch(\"\".concat(env.apiAddress).concat(props.dataUrl, \"?page=\").concat(index + 1, \"&page_size=\").concat(pageSize), {\n            method: 'post',\n            body: JSON.stringify(props.requestBody()),\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            signal: getSignal()\n          }, 5);\n          const data = requestMiddleware(await res.json());\n\n          if (Array.isArray(data)) {\n            setData(data);\n\n            if (data.length < pageSize) {\n              setMaxIndex(index);\n            }\n          } else {\n            setData([]);\n          }\n        } catch (err) {\n          console.log(err);\n        } finally {\n          if (isMounted.current) {\n            setIsloading(false);\n          }\n\n          ;\n        }\n      };\n\n      fetchApi(); // Unmount\n\n      return () => {\n        abortAll();\n      };\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [index, tags, refresh]);\n\n  const createRow = (row, i) => {\n    const absoluteIndex = index * pageSize + i;\n    return /*#__PURE__*/_createElement(\"tr\", { ...trProps(row),\n      key: absoluteIndex,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 7\n      }\n    }, columnsNames.map((columnName, rowIndex) => {\n      const column = props.columns[columnName];\n\n      if (column.constructor === Object) {\n        const args = column['args'];\n        const fieldData = (args === null || args === void 0 ? void 0 : args.constructor) === Array ? args.map(arg => row[arg]) : row[args];\n\n        if (invalid.includes(fieldData) || (args === null || args === void 0 ? void 0 : args.constructor) === Array && fieldData.every(field => invalid.includes(field))) {\n          if (column['defaultValue']) {\n            return /*#__PURE__*/_jsxDEV(\"td\", {\n              style: column.tdStyle,\n              children: column['defaultValue']\n            }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 26\n            }, this);\n          }\n\n          return /*#__PURE__*/_jsxDEV(\"td\", {\n            style: column.tdStyle\n          }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 24\n          }, this);\n        }\n\n        if (column.func) return /*#__PURE__*/_jsxDEV(\"td\", {\n          style: column.tdStyle,\n          children: column.func(fieldData)\n        }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 19\n        }, this);\n\n        if (column.Func) {\n          const Component = column.Func;\n          return /*#__PURE__*/_jsxDEV(\"td\", {\n            style: column.tdStyle,\n            children: /*#__PURE__*/_jsxDEV(Component, {\n              data: fieldData,\n              row_data: row,\n              index: i\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 21\n            }, this)\n          }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 19\n          }, this);\n        }\n\n        return /*#__PURE__*/_jsxDEV(\"td\", {\n          style: column.tdStyle,\n          children: fieldData\n        }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 17\n        }, this);\n      } else return /*#__PURE__*/_jsxDEV(\"td\", {\n        style: column.tdStyle,\n        children: invalid.includes(row[column]) ? '' : row[column]\n      }, \"cell-\".concat(rowIndex, \"-\").concat(absoluteIndex), false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 17\n      }, this);\n    }));\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [!hideTopBar && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: dummyRef,\n        className: \"topbar\",\n        onScroll: handleScroll,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: tableRef === null || tableRef === void 0 ? void 0 : (_tableRef$current = tableRef.current) === null || _tableRef$current === void 0 ? void 0 : _tableRef$current.offsetWidth\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"table-loading-responsive\",\n      ref: containerRef,\n      onScroll: handleScroll,\n      children: [/*#__PURE__*/_jsxDEV(\"table\", {\n        className: \"table normal \".concat(isLoading && 'loading'),\n        ref: tableRef,\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          className: \"text-primary\",\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: columnsNames.map(columnName => {\n              return /*#__PURE__*/_jsxDEV(\"th\", {\n                style: props.columns[columnName].thStyle,\n                children: columnName\n              }, columnName, false, {\n                fileName: _jsxFileName,\n                lineNumber: 224,\n                columnNumber: 19\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: props.fillData && tableData.length === 0 && isLoading ? Array(pageSize).fill(0).map((_, rowIndex) => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: Array(columnsNames.length).fill(0).map((_, columnIndex) => /*#__PURE__*/_jsxDEV(\"td\", {\n              children: '. . .'\n            }, \"cell-\".concat(rowIndex, \"-\").concat(columnIndex), false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 25\n            }, this))\n          }, \"row-\".concat(rowIndex), false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 21\n          }, this)) : props.dataUrl && props.requestBody ? tableData.map(createRow) : tableData.slice(index * pageSize, (index + 1) * pageSize).map(createRow)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), props.showRecords && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: '0.9rem',\n          marginTop: '8px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontWeight: 'bolder'\n          },\n          children: props.data.length\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 13\n        }, this), \" Registro(s) encontrado(s)\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this), !props.hidePagination && /*#__PURE__*/_jsxDEV(Pagination, {\n      state: [index, setIndex],\n      maxIndex: maxIndex,\n      isLoading: isLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Table, \"kVoTQ+SGeMjSQg59OfihakYpIMs=\", false, function () {\n  return [useAbortController];\n});\n\n_c = Table;\n;\n\nvar _c;\n\n$RefreshReg$(_c, \"Table\");","map":{"version":3,"sources":["C:/Users/rodri/OneDrive/Documentos/cicc-app/front-end/src/components/tables/Table.js"],"names":["React","axios","fetch","Pagination","isAdmin","env","axiosRetry","getTimeoutConfig","getRetryConfig","useAbortController","emptyFunction","value","Table","props","isMounted","useRef","data","setData","useState","tableData","pageSize","index","setIndex","maxIndex","setMaxIndex","Math","ceil","length","isLoading","setIsloading","loading","columnsNames","Object","keys","columns","filter","columnName","adminOnly","refresh","tags","invalid","undefined","requestMiddleware","trProps","hideTopBar","dummyRef","containerRef","tableRef","configAxios","create","getSignal","abortAll","delay","ms","Promise","resolve","setTimeout","retryFetch","url","fetchOptions","retries","retryDelay","timeout","reject","wrapper","n","then","res","catch","err","handleScroll","e","target","current","scrollLeft","useEffect","countUrl","countRequestBody","body","post","apiAddress","console","log","dataUrl","requestBody","fetchApi","method","JSON","stringify","headers","signal","json","Array","isArray","createRow","row","i","absoluteIndex","map","rowIndex","column","constructor","args","fieldData","arg","includes","every","field","tdStyle","func","Func","Component","width","offsetWidth","thStyle","fillData","fill","_","columnIndex","slice","showRecords","fontSize","marginTop","fontWeight","hidePagination"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport axios from \"axios\";\r\nimport fetch from 'node-fetch';\r\n\r\nimport Pagination from \"./Pagination\";\r\nimport { isAdmin } from 'common/SessionUtils';\r\nimport env from 'common/enviroment';\r\nimport axiosRetry from 'axios-retry';\r\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\r\nimport { getRetryConfig } from \"axios/AxiosUtils\";\r\nimport { useAbortController }\r\nfrom 'common/hooks/useAbortController';\r\n\r\nfunction emptyFunction(value) {\r\n  return value\r\n};\r\n\r\nexport default function Table(props) {\r\n  const isMounted = React.useRef(true);\r\n\r\n  const [data, setData] = React.useState([])\r\n  const tableData = props.data || data\r\n\r\n  const pageSize = props.pageSize || 10\r\n  const [index, setIndex] = React.useState(0)\r\n  const [maxIndex, setMaxIndex] = React.useState(props.data ? Math.ceil(tableData.length / pageSize) : -1)\r\n  const [isLoading, setIsloading] = props.loading || [null, () => { }]\r\n\r\n  const columnsNames = Object.keys(props.columns).filter(columnName => props.columns[columnName].adminOnly ? isAdmin() : true)\r\n  const refresh = props.refresh\r\n  const tags = props.tags\r\n  const invalid = props.invalid || [null, undefined]\r\n  const requestMiddleware = props.requestMiddleware || emptyFunction\r\n  const trProps = props.trProps || (() => { })\r\n  const hideTopBar = props.hideTopBar || false\r\n\r\n  const dummyRef = React.useRef()\r\n  const containerRef = React.useRef()\r\n  const tableRef = React.useRef()\r\n\r\n  const configAxios = axios.create(getTimeoutConfig());\r\n  axiosRetry(configAxios, getRetryConfig());\r\n  const { getSignal, abortAll } = useAbortController();\r\n  \r\n  const delay = (ms) => new Promise((resolve) => setTimeout(() => resolve(), ms));\r\n\r\n  const retryFetch = (\r\n    url,\r\n    fetchOptions = {},\r\n    retries = 3,\r\n    retryDelay = 1000,\r\n    timeout\r\n  ) => {\r\n    return new Promise((resolve, reject) => {\r\n      // check for timeout\r\n      if (timeout) setTimeout(() => reject('error: timeout'), timeout);\r\n  \r\n      const wrapper = (n) => {\r\n        fetch(url, fetchOptions)\r\n          .then((res) => resolve(res))\r\n          .catch(async (err) => {\r\n            if (n > 0) {\r\n              await delay(retryDelay);\r\n              wrapper(--n);\r\n            } else {\r\n              reject(err);\r\n            }\r\n          });\r\n      };\r\n  \r\n      wrapper(retries);\r\n    });\r\n  };\r\n\r\n  const handleScroll = (e) => {\r\n    if (e.target === dummyRef.current && containerRef.current) {\r\n      containerRef.current.scrollLeft = e.target.scrollLeft;\r\n    }\r\n    else if (e.target === containerRef.current && dummyRef.current) {\r\n      dummyRef.current.scrollLeft = e.target.scrollLeft;\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      isMounted.current = false;\r\n    };\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    setIndex(0)\r\n    setMaxIndex(-1)\r\n\r\n    if (props.countUrl && props.countRequestBody) {\r\n      let body = props.countRequestBody()\r\n\r\n      configAxios.post(`${env.apiAddress}${props.countUrl}`, body).then(res => {\r\n        if (res.data[0] && res.data[0]['aggregate']) {\r\n          setMaxIndex(Math.ceil(res.data[0]['aggregate']['count'] / pageSize) - 1)\r\n        }\r\n      }).catch(err => {\r\n        console.log(err)\r\n      })\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [tags]);\r\n\r\n  React.useEffect(() => {\r\n    // Request data\r\n    if (props.dataUrl && props.requestBody) {\r\n      const fetchApi = async () => {\r\n        try {\r\n          setIsloading(true)\r\n          /*const res = await fetch(`${env.apiAddress}${props.dataUrl}?page=${index + 1}&page_size=${pageSize}`, {\r\n            method: 'post',\r\n            body: JSON.stringify(props.requestBody()),\r\n            headers: { 'Content-Type': 'application/json' }\r\n          })*/\r\n          const res = await retryFetch(`${env.apiAddress}${props.dataUrl}?page=${index + 1}&page_size=${pageSize}`, {\r\n            method: 'post',\r\n            body: JSON.stringify(props.requestBody()),\r\n            headers: { 'Content-Type': 'application/json' },\r\n            signal: getSignal()\r\n          }, 5)\r\n          const data = requestMiddleware(await res.json())\r\n          if (Array.isArray(data)) {\r\n            setData(data)\r\n            if (data.length < pageSize) {\r\n              setMaxIndex(index)\r\n            }\r\n          }\r\n          else {\r\n            setData([])\r\n          }\r\n        }\r\n        catch (err) {\r\n          console.log(err)\r\n        }\r\n        finally {\r\n          if (isMounted.current) {\r\n            setIsloading(false);\r\n          };\r\n        }\r\n      }\r\n      fetchApi();\r\n\r\n      // Unmount\r\n      return () => {\r\n        abortAll();\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [index, tags, refresh]);\r\n\r\n  const createRow = (row, i) => {\r\n    const absoluteIndex = index * pageSize + i\r\n\r\n    return (\r\n      <tr {...trProps(row)} key={absoluteIndex}>\r\n        {\r\n          columnsNames.map((columnName, rowIndex) => {\r\n            const column = props.columns[columnName]\r\n\r\n            if (column.constructor === Object) {\r\n              const args = column['args']\r\n              const fieldData = args?.constructor === Array ? args.map(arg => row[arg]) : row[args]\r\n\r\n              if (invalid.includes(fieldData) || (args?.constructor === Array && fieldData.every(field => invalid.includes(field)))) {\r\n                if (column['defaultValue']) {\r\n                  return <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`} >{column['defaultValue']}</td>\r\n                }\r\n                return <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`} />\r\n              }\r\n\r\n              if (column.func)\r\n                return (\r\n                  <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`}>\r\n                    {column.func(fieldData)}\r\n                  </td>\r\n                )\r\n\r\n              if (column.Func) {\r\n                const Component = column.Func\r\n                return (\r\n                  <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`} >\r\n                    <Component data={fieldData} row_data={row} index={i} />\r\n                  </td>\r\n                )\r\n              }\r\n\r\n              return (\r\n                <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`} >\r\n                  {fieldData}\r\n                </td>\r\n              )\r\n            }\r\n            else\r\n              return (\r\n                <td style={column.tdStyle} key={`cell-${rowIndex}-${absoluteIndex}`} >\r\n                  {invalid.includes(row[column]) ? '' : row[column]}\r\n                </td>\r\n              )\r\n          })\r\n        }\r\n      </tr>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {!hideTopBar &&\r\n        <div>\r\n          <div ref={dummyRef} className=\"topbar\" onScroll={handleScroll} >\r\n            <div style={{ width: tableRef?.current?.offsetWidth }} />\r\n          </div>\r\n        </div>\r\n      }\r\n      <div className=\"table-loading-responsive\" ref={containerRef} onScroll={handleScroll}>\r\n        <table className={`table normal ${isLoading && 'loading'}`} ref={tableRef} >\r\n          <thead className=\"text-primary\">\r\n            <tr>\r\n              {columnsNames.map(columnName => {\r\n                return (\r\n                  <th\r\n                    key={columnName}\r\n                    style={props.columns[columnName].thStyle}\r\n                  >\r\n                    {columnName}\r\n                  </th>\r\n                )\r\n              })}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {\r\n              props.fillData && (tableData.length === 0 && isLoading) ?\r\n                (\r\n                  Array(pageSize).fill(0).map((_, rowIndex) => (\r\n                    <tr key={`row-${rowIndex}`}>\r\n                      {Array(columnsNames.length).fill(0).map((_, columnIndex) => (\r\n                        <td key={`cell-${rowIndex}-${columnIndex}`}>{'. . .'}</td>\r\n                      ))}\r\n                    </tr>\r\n                  ))\r\n                )\r\n                :\r\n                (\r\n                  props.dataUrl && props.requestBody ?\r\n                    tableData.map(createRow)\r\n                    :\r\n                    tableData.slice(\r\n                      index * pageSize,\r\n                      (index + 1) * pageSize\r\n                    ).map(createRow)\r\n                )\r\n            }\r\n          </tbody>\r\n        </table>\r\n        {props.showRecords &&\r\n          <div style={{ fontSize: '0.9rem', marginTop: '8px' }}>\r\n            <span style={{ fontWeight: 'bolder' }}>{props.data.length}</span> Registro(s) encontrado(s)\r\n          </div>\r\n        }\r\n      </div>\r\n\r\n      {!props.hidePagination &&\r\n        <Pagination\r\n          state={[index, setIndex]}\r\n          maxIndex={maxIndex}\r\n          isLoading={isLoading}\r\n        />\r\n      }\r\n    </>\r\n  );\r\n};"]},"metadata":{},"sourceType":"module"}