{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rodri\\\\OneDrive\\\\Documentos\\\\cicc-app\\\\front-end\\\\src\\\\views\\\\Traffic\\\\Traffic.js\",\n    _s = $RefreshSig$();\n\n/*!\r\n\r\n=========================================================\r\n* Paper Dashboard React - v1.2.0\r\n=========================================================\r\n\r\n* Product Page: https://www.creative-tim.com/product/paper-dashboard-react\r\n* Copyright 2020 Creative Tim (https://www.creative-tim.com)\r\n\r\n* Licensed under MIT (https://github.com/creativetimofficial/paper-dashboard-react/blob/master/LICENSE.md)\r\n\r\n* Coded by Creative Tim\r\n\r\n=========================================================\r\n\r\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n\r\n*/\nimport React, { useMemo } from \"react\";\nimport { Card, CardBody, Row, Col } from \"reactstrap\";\nimport env from \"common/enviroment\";\nimport { useHistory } from \"react-router-dom\";\nimport { useJsApiLoader } from '@react-google-maps/api';\nimport { NavigationContext } from 'context/NavigationContext';\nimport { WarningsContext } from 'context/WarningsContext';\nimport { GroupsContext } from 'context/GroupsContext';\nimport { AuditorsContext } from 'context/AuditorsContext';\nimport { WarningsUpdateContext } from \"context/WarningsUpdateContext\";\nimport Tabs from \"components/Tabs\";\nimport MODAL_TYPE_ENUM from \"common/enumerators/ModalTypeEnum\";\nimport { isSubgerente, isNearClosingWarningModalEnabled, setNearClosingWarningModalEnabled } from \"common/SessionUtils\";\nimport { isAdmin, isLoggedIn, reloadVisibilityGroups } from \"common/SessionUtils\";\nimport { isMonitoramento } from \"common/SessionUtils\";\nimport { isExternalUser } from \"common/SessionUtils\";\nimport { useModalWithData } from \"common/hooks/useModalWithData\";\nimport useToggle from \"common/hooks/useToogle\";\nimport { isEmpty } from \"common/utils/collections\";\nimport ReadNearClosingWarningConfig from \"axios/ReadNearClosingWarningConfig\";\nimport NearClosingWarningModal from \"components/modals/NearClosingWarningModal/NearClosingWarningModal\";\nimport WarningTable from \"./tables/WarningTable\";\nimport TrafficNoDfeTable from \"./tables/TrafficNoDfeTable\";\nimport TrafficDfeTable from \"./tables/TrafficDfeTable\";\nimport LocationTrackingModal from \"components/modals/LocationTrackingModal/LocationTrackingModal\";\nimport useAsync from \"common/hooks/useAsync\";\nimport LoadingPage from \"layouts/Loading\";\nimport { delay } from \"common/utils/forms\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function Traffic(props) {\n  _s();\n\n  const history = useHistory();\n  const {\n    fetchGroupsData,\n    groupsDataMap,\n    groupsSimpleMap,\n    fetchGroupsName\n  } = React.useContext(GroupsContext);\n  const {\n    setIsMap\n  } = React.useContext(NavigationContext);\n  const {\n    startSSE,\n    wasReloaded,\n    setWasReloaded\n  } = React.useContext(WarningsContext);\n  const {\n    startWarningsViewedSSE\n  } = React.useContext(WarningsUpdateContext);\n  const {\n    auditorsData,\n    getAuditorsData\n  } = React.useContext(AuditorsContext);\n  const [tabIndex, setTabIndex] = React.useState(0);\n  const [fetchDataFlag, toggleFetchData] = useToggle(false);\n  const {\n    modalData,\n    setModalData,\n    isModalActive,\n    modalType,\n    toggleModalOn,\n    toggleModalOff\n  } = useModalWithData();\n  const tabs = isAdmin() || isSubgerente() || isMonitoramento() || isExternalUser() ? ['Tabela de alertas', 'Tabela de tráfego sem DFe', 'Tabela de tráfego com DFe'] : ['Tabela de alertas'];\n  const {\n    readNearClosingWarningConfigRequest\n  } = ReadNearClosingWarningConfig();\n  const {\n    isLoaded,\n    loadError\n  } = useJsApiLoader({\n    id: 'google-map-script',\n    googleMapsApiKey: env.googleApiKey\n  });\n  const {\n    loading\n  } = useAsync(async () => {\n    if (wasReloaded && isLoggedIn()) {\n      setIsMap(false);\n      reloadVisibilityGroups();\n\n      if (isEmpty(groupsDataMap)) {\n        await fetchGroupsData();\n      }\n\n      if (isEmpty(groupsSimpleMap)) {\n        await fetchGroupsName();\n      }\n\n      if (isEmpty(auditorsData)) {\n        await getAuditorsData();\n      }\n\n      await emitNearCloseWarningNotification();\n      startWarningsViewedSSE();\n      startSSE();\n      await delay(2000);\n      setWasReloaded(false);\n    }\n  }, [wasReloaded]);\n  React.useEffect(() => {\n    if (!isLoggedIn()) {\n      history.push('/login');\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n\n  const emitNearCloseWarningNotification = async () => {\n    if (!isNearClosingWarningModalEnabled()) return;\n    let result = await readNearClosingWarningConfigRequest();\n\n    if (result.length > 0) {\n      toggleModalOn(MODAL_TYPE_ENUM.NEAR_CLOSING_WARNING, result);\n    }\n\n    setNearClosingWarningModalEnabled(false);\n  };\n\n  const toggleMapModal = data => {\n    setModalData(data);\n    toggleModalOn(MODAL_TYPE_ENUM.MAP, data);\n    toggleFetchData();\n  }; // eslint-disable-next-line react-hooks/exhaustive-deps\n\n\n  const createMapModal = useMemo(() => /*#__PURE__*/_jsxDEV(LocationTrackingModal, {\n    show: isModalActive,\n    googleMapOnLoad: isLoaded,\n    googleMapOnError: loadError,\n    toggle: toggleModalOff,\n    data: modalData,\n    fetchData: fetchDataFlag\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 40\n  }, this), [modalData]);\n\n  if (loading && wasReloaded) {\n    return /*#__PURE__*/_jsxDEV(LoadingPage, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 12\n    }, this);\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"content\",\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            md: \"12\",\n            children: [/*#__PURE__*/_jsxDEV(Tabs, {\n              names: tabs,\n              index: [tabIndex, setTabIndex]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Card, {\n              className: \"card\",\n              style: {\n                borderTopLeftRadius: '0px'\n              },\n              children: /*#__PURE__*/_jsxDEV(CardBody, {\n                children: [tabIndex === 0 && /*#__PURE__*/_jsxDEV(WarningTable, {\n                  toggleMapModal: toggleMapModal\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 151,\n                  columnNumber: 21\n                }, this), tabIndex === 1 && /*#__PURE__*/_jsxDEV(TrafficNoDfeTable, {\n                  toggleMapModal: toggleMapModal\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 154,\n                  columnNumber: 21\n                }, this), tabIndex === 2 && /*#__PURE__*/_jsxDEV(TrafficDfeTable, {\n                  toggleMapModal: toggleMapModal\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 157,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 149,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this), modalType === MODAL_TYPE_ENUM.MAP && createMapModal, modalType === MODAL_TYPE_ENUM.NEAR_CLOSING_WARNING && /*#__PURE__*/_jsxDEV(NearClosingWarningModal, {\n          show: isModalActive,\n          toggle: toggleModalOff,\n          data: modalData\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 66\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this)\n    }, void 0, false);\n  }\n}\n\n_s(Traffic, \"JZGK4v8jY8ry9CcCno/ZYv42Uw4=\", false, function () {\n  return [useHistory, useToggle, useModalWithData, useJsApiLoader, useAsync];\n});\n\n_c = Traffic;\n\nvar _c;\n\n$RefreshReg$(_c, \"Traffic\");","map":{"version":3,"sources":["C:/Users/rodri/OneDrive/Documentos/cicc-app/front-end/src/views/Traffic/Traffic.js"],"names":["React","useMemo","Card","CardBody","Row","Col","env","useHistory","useJsApiLoader","NavigationContext","WarningsContext","GroupsContext","AuditorsContext","WarningsUpdateContext","Tabs","MODAL_TYPE_ENUM","isSubgerente","isNearClosingWarningModalEnabled","setNearClosingWarningModalEnabled","isAdmin","isLoggedIn","reloadVisibilityGroups","isMonitoramento","isExternalUser","useModalWithData","useToggle","isEmpty","ReadNearClosingWarningConfig","NearClosingWarningModal","WarningTable","TrafficNoDfeTable","TrafficDfeTable","LocationTrackingModal","useAsync","LoadingPage","delay","Traffic","props","history","fetchGroupsData","groupsDataMap","groupsSimpleMap","fetchGroupsName","useContext","setIsMap","startSSE","wasReloaded","setWasReloaded","startWarningsViewedSSE","auditorsData","getAuditorsData","tabIndex","setTabIndex","useState","fetchDataFlag","toggleFetchData","modalData","setModalData","isModalActive","modalType","toggleModalOn","toggleModalOff","tabs","readNearClosingWarningConfigRequest","isLoaded","loadError","id","googleMapsApiKey","googleApiKey","loading","emitNearCloseWarningNotification","useEffect","push","result","length","NEAR_CLOSING_WARNING","toggleMapModal","data","MAP","createMapModal","borderTopLeftRadius"],"mappings":"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","sourcesContent":["/*!\r\n\r\n=========================================================\r\n* Paper Dashboard React - v1.2.0\r\n=========================================================\r\n\r\n* Product Page: https://www.creative-tim.com/product/paper-dashboard-react\r\n* Copyright 2020 Creative Tim (https://www.creative-tim.com)\r\n\r\n* Licensed under MIT (https://github.com/creativetimofficial/paper-dashboard-react/blob/master/LICENSE.md)\r\n\r\n* Coded by Creative Tim\r\n\r\n=========================================================\r\n\r\n* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\r\n\r\n*/\r\nimport React, { useMemo } from \"react\";\r\nimport {\r\n  Card,\r\n  CardBody,\r\n  Row,\r\n  Col,\r\n} from \"reactstrap\";\r\n\r\nimport env from \"common/enviroment\";\r\n\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { useJsApiLoader } from '@react-google-maps/api';\r\nimport { NavigationContext } from 'context/NavigationContext'\r\nimport { WarningsContext } from 'context/WarningsContext';\r\nimport { GroupsContext } from 'context/GroupsContext';\r\nimport { AuditorsContext } from 'context/AuditorsContext';\r\nimport { WarningsUpdateContext } from \"context/WarningsUpdateContext\";\r\nimport Tabs from \"components/Tabs\";\r\nimport MODAL_TYPE_ENUM from \"common/enumerators/ModalTypeEnum\";\r\nimport { isSubgerente, isNearClosingWarningModalEnabled, setNearClosingWarningModalEnabled } from \"common/SessionUtils\";\r\nimport { isAdmin, isLoggedIn, reloadVisibilityGroups } from \"common/SessionUtils\";\r\nimport { isMonitoramento } from \"common/SessionUtils\";\r\nimport { isExternalUser } from \"common/SessionUtils\";\r\nimport { useModalWithData } from \"common/hooks/useModalWithData\";\r\nimport useToggle from \"common/hooks/useToogle\";\r\nimport { isEmpty } from \"common/utils/collections\";\r\nimport ReadNearClosingWarningConfig from \"axios/ReadNearClosingWarningConfig\";\r\nimport NearClosingWarningModal from \"components/modals/NearClosingWarningModal/NearClosingWarningModal\";\r\nimport WarningTable from \"./tables/WarningTable\";\r\nimport TrafficNoDfeTable from \"./tables/TrafficNoDfeTable\";\r\nimport TrafficDfeTable from \"./tables/TrafficDfeTable\";\r\nimport LocationTrackingModal from \"components/modals/LocationTrackingModal/LocationTrackingModal\";\r\nimport useAsync from \"common/hooks/useAsync\";\r\nimport LoadingPage from \"layouts/Loading\";\r\nimport { delay } from \"common/utils/forms\";\r\n\r\n\r\nexport default function Traffic(props) {\r\n  const history = useHistory()\r\n  const { fetchGroupsData, groupsDataMap, groupsSimpleMap, fetchGroupsName  } = React.useContext(GroupsContext);\r\n  const { setIsMap } = React.useContext(NavigationContext);\r\n  const { startSSE, wasReloaded, setWasReloaded } = React.useContext(WarningsContext);\r\n  const { startWarningsViewedSSE } = React.useContext(WarningsUpdateContext)\r\n  const { auditorsData, getAuditorsData } = React.useContext(AuditorsContext);\r\n  const [tabIndex, setTabIndex] = React.useState(0)\r\n  const [fetchDataFlag, toggleFetchData] = useToggle(false)\r\n  const { modalData, setModalData, isModalActive, modalType, toggleModalOn, toggleModalOff } = useModalWithData()\r\n\r\n  const tabs = isAdmin() || isSubgerente() || isMonitoramento() || isExternalUser() ? ['Tabela de alertas', 'Tabela de tráfego sem DFe', 'Tabela de tráfego com DFe'] : ['Tabela de alertas']\r\n\r\n  const { readNearClosingWarningConfigRequest } = ReadNearClosingWarningConfig()\r\n\r\n\r\n  const { isLoaded, loadError } = useJsApiLoader({\r\n    id: 'google-map-script',\r\n    googleMapsApiKey: env.googleApiKey\r\n  })\r\n\r\n  const { loading } = useAsync(async () => {\r\n    if (wasReloaded && isLoggedIn()) {\r\n      setIsMap(false);\r\n      reloadVisibilityGroups()\r\n\r\n      if (isEmpty(groupsDataMap)) {\r\n        await fetchGroupsData()\r\n      }\r\n\r\n      if (isEmpty(groupsSimpleMap)) {\r\n        await fetchGroupsName()\r\n      }\r\n\r\n      if (isEmpty(auditorsData)) {\r\n        await getAuditorsData();\r\n      }\r\n\r\n      await emitNearCloseWarningNotification()\r\n\r\n      startWarningsViewedSSE()\r\n      startSSE()\r\n\r\n      await delay(2000);\r\n      setWasReloaded(false)\r\n    }\r\n  }, [wasReloaded]);\r\n\r\n\r\n  React.useEffect(() => {\r\n    if (!isLoggedIn()) {\r\n      history.push('/login')\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [])\r\n\r\n\r\n\r\n  const emitNearCloseWarningNotification = async () => {\r\n    if (!isNearClosingWarningModalEnabled())\r\n      return\r\n\r\n    let result = await readNearClosingWarningConfigRequest()\r\n    if (result.length > 0) {\r\n      toggleModalOn(MODAL_TYPE_ENUM.NEAR_CLOSING_WARNING, result)\r\n\r\n    }\r\n\r\n    setNearClosingWarningModalEnabled(false);\r\n  }\r\n\r\n\r\n  const toggleMapModal = (data) => {\r\n    setModalData(data)\r\n    toggleModalOn(MODAL_TYPE_ENUM.MAP, data)\r\n    toggleFetchData()\r\n  }\r\n\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const createMapModal = useMemo(() => <LocationTrackingModal show={isModalActive} googleMapOnLoad={isLoaded} googleMapOnError={loadError} toggle={toggleModalOff} data={modalData} fetchData={fetchDataFlag} />, [modalData]);\r\n\r\n  if (loading && wasReloaded) {\r\n    return <LoadingPage />\r\n  } else {\r\n    return (\r\n      <>\r\n\r\n        <div className=\"content\">\r\n          <Row>\r\n            <Col md=\"12\">\r\n              <Tabs names={tabs} index={[tabIndex, setTabIndex]} />\r\n              <Card className=\"card\" style={{ borderTopLeftRadius: '0px' }}>\r\n                <CardBody>\r\n                  {tabIndex === 0 &&\r\n                    <WarningTable toggleMapModal={toggleMapModal} />\r\n                  }\r\n                  {tabIndex === 1 &&\r\n                    <TrafficNoDfeTable toggleMapModal={toggleMapModal} />\r\n                  }\r\n                  {tabIndex === 2 &&\r\n                    <TrafficDfeTable toggleMapModal={toggleMapModal} />\r\n\r\n                  }\r\n                </CardBody>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n\r\n          {modalType === MODAL_TYPE_ENUM.MAP && createMapModal}\r\n          {modalType === MODAL_TYPE_ENUM.NEAR_CLOSING_WARNING && <NearClosingWarningModal show={isModalActive} toggle={toggleModalOff} data={modalData} />}\r\n\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}