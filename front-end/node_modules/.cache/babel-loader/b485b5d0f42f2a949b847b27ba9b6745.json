{"ast":null,"code":"var _jsxFileName = \"C:\\\\aria\\\\cicc-app\\\\front-end\\\\src\\\\context\\\\WarningsUpdateContext.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport env from 'common/enviroment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const WarningsUpdateContext = /*#__PURE__*/React.createContext();\nexport function WarningsUpdateProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n\n  const EventSource = require('eventsource');\n\n  const [warningsViewed, setWarningsViewed] = React.useState({});\n  const [lastWarningUpdate, setLastWarningUpdate] = React.useState({});\n\n  const startWarningsViewedSSE = () => {\n    let warningUpdate = new EventSource(\"\".concat(env.apiAddress, \"/warnings/stream_view\"));\n\n    warningUpdate.onmessage = event => {\n      console.log('recebi warning atualizado: ', event);\n\n      if (event) {\n        let object_warning = JSON.parse(event.data.replace(/'/g, '\"'));\n        setLastWarningUpdate(object_warning);\n      }\n    };\n  };\n\n  React.useEffect(() => {\n    if (Object.keys(lastWarningUpdate).length !== 0) {\n      let id = lastWarningUpdate.id.toString();\n\n      if (!Object.keys(warningsViewed).includes(id)) {\n        setWarningsViewed(prevState => ({ ...prevState,\n          [id]: { ...lastWarningUpdate,\n            checked: true\n          }\n        }));\n      } else {\n        setWarningsViewed(prevState => ({ ...prevState,\n          [id]: { ...prevState[id],\n            lock: lastWarningUpdate.lock,\n            status: lastWarningUpdate.status\n          }\n        }));\n      }\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [lastWarningUpdate]);\n  return /*#__PURE__*/_jsxDEV(WarningsUpdateContext.Provider, {\n    value: {\n      startWarningsViewedSSE,\n      warningsViewed,\n      setWarningsViewed,\n      lastWarningUpdate,\n      setLastWarningUpdate\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 50,\n    columnNumber: 5\n  }, this);\n}\n\n_s(WarningsUpdateProvider, \"ywHBadYdBJxShX2m66q1xEZ69pM=\");\n\n_c = WarningsUpdateProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"WarningsUpdateProvider\");","map":{"version":3,"sources":["C:/aria/cicc-app/front-end/src/context/WarningsUpdateContext.js"],"names":["React","env","WarningsUpdateContext","createContext","WarningsUpdateProvider","children","EventSource","require","warningsViewed","setWarningsViewed","useState","lastWarningUpdate","setLastWarningUpdate","startWarningsViewedSSE","warningUpdate","apiAddress","onmessage","event","console","log","object_warning","JSON","parse","data","replace","useEffect","Object","keys","length","id","toString","includes","prevState","checked","lock","status"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,OAAOC,GAAP,MAAgB,mBAAhB;;AAEA,OAAO,MAAMC,qBAAqB,gBAAGF,KAAK,CAACG,aAAN,EAA9B;AAEP,OAAO,SAASC,sBAAT,OAA8C;AAAA;;AAAA,MAAd;AAAEC,IAAAA;AAAF,GAAc;;AACnD,QAAMC,WAAW,GAAGC,OAAO,CAAC,aAAD,CAA3B;;AACA,QAAM,CAACC,cAAD,EAAiBC,iBAAjB,IAAsCT,KAAK,CAACU,QAAN,CAAe,EAAf,CAA5C;AACA,QAAM,CAACC,iBAAD,EAAoBC,oBAApB,IAA4CZ,KAAK,CAACU,QAAN,CAAe,EAAf,CAAlD;;AAEA,QAAMG,sBAAsB,GAAG,MAAM;AAEnC,QAAIC,aAAa,GAAG,IAAIR,WAAJ,WAAmBL,GAAG,CAACc,UAAvB,2BAApB;;AAEAD,IAAAA,aAAa,CAACE,SAAd,GAA2BC,KAAD,IAAW;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2CF,KAA3C;;AACA,UAAIA,KAAJ,EAAU;AAER,YAAIG,cAAc,GAAGC,IAAI,CAACC,KAAL,CAAWL,KAAK,CAACM,IAAN,CAAWC,OAAX,CAAmB,IAAnB,EAAyB,GAAzB,CAAX,CAArB;AAEAZ,QAAAA,oBAAoB,CAACQ,cAAD,CAApB;AACD;AACF,KARD;AASD,GAbD;;AAeApB,EAAAA,KAAK,CAACyB,SAAN,CAAgB,MAAM;AAEpB,QAAIC,MAAM,CAACC,IAAP,CAAYhB,iBAAZ,EAA+BiB,MAA/B,KAA0C,CAA9C,EAAgD;AAE9C,UAAIC,EAAE,GAAGlB,iBAAiB,CAACkB,EAAlB,CAAqBC,QAArB,EAAT;;AACA,UAAG,CAACJ,MAAM,CAACC,IAAP,CAAYnB,cAAZ,EAA4BuB,QAA5B,CAAqCF,EAArC,CAAJ,EAA6C;AAE3CpB,QAAAA,iBAAiB,CAAEuB,SAAD,KAAgB,EAChC,GAAGA,SAD6B;AAEhC,WAACH,EAAD,GAAM,EAAC,GAAGlB,iBAAJ;AAAuBsB,YAAAA,OAAO,EAAE;AAAhC;AAF0B,SAAhB,CAAD,CAAjB;AAID,OAND,MAMK;AACHxB,QAAAA,iBAAiB,CAAEuB,SAAD,KAAgB,EAChC,GAAGA,SAD6B;AAEhC,WAACH,EAAD,GAAM,EAAC,GAAGG,SAAS,CAACH,EAAD,CAAb;AAAmBK,YAAAA,IAAI,EAAEvB,iBAAiB,CAACuB,IAA3C;AAAiDC,YAAAA,MAAM,EAAExB,iBAAiB,CAACwB;AAA3E;AAF0B,SAAhB,CAAD,CAAjB;AAID;AACF,KAjBmB,CAmBpB;;AACD,GApBD,EAoBG,CAACxB,iBAAD,CApBH;AAsBA,sBACE,QAAC,qBAAD,CAAuB,QAAvB;AAAgC,IAAA,KAAK,EAAE;AAAEE,MAAAA,sBAAF;AAA0BL,MAAAA,cAA1B;AAA0CC,MAAAA,iBAA1C;AAA6DE,MAAAA,iBAA7D;AAAgFC,MAAAA;AAAhF,KAAvC;AAAA,cACGP;AADH;AAAA;AAAA;AAAA;AAAA,UADF;AAKD;;GA/CeD,sB;;KAAAA,sB","sourcesContent":["import React from \"react\";\r\n\r\nimport env from 'common/enviroment'\r\n\r\nexport const WarningsUpdateContext = React.createContext();\r\n\r\nexport function WarningsUpdateProvider({ children }) {\r\n  const EventSource = require('eventsource')\r\n  const [warningsViewed, setWarningsViewed] = React.useState({})\r\n  const [lastWarningUpdate, setLastWarningUpdate] = React.useState({})\r\n\r\n  const startWarningsViewedSSE = () => {\r\n\r\n    let warningUpdate = new EventSource(`${env.apiAddress}/warnings/stream_view`)\r\n\r\n    warningUpdate.onmessage = (event) => {\r\n      console.log('recebi warning atualizado: ', event)\r\n      if (event){\r\n\r\n        let object_warning = JSON.parse(event.data.replace(/'/g, '\"'))\r\n\r\n        setLastWarningUpdate(object_warning)\r\n      }\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n\r\n    if (Object.keys(lastWarningUpdate).length !== 0){\r\n\r\n      let id = lastWarningUpdate.id.toString()\r\n      if(!Object.keys(warningsViewed).includes(id)){\r\n\r\n        setWarningsViewed((prevState) => ({\r\n          ...prevState,\r\n          [id]: {...lastWarningUpdate, checked: true}\r\n        }))\r\n      }else{\r\n        setWarningsViewed((prevState) => ({\r\n          ...prevState,\r\n          [id]: {...prevState[id], lock: lastWarningUpdate.lock, status: lastWarningUpdate.status}\r\n        }))\r\n      }\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [lastWarningUpdate])\r\n\r\n  return (\r\n    <WarningsUpdateContext.Provider value={{ startWarningsViewedSSE, warningsViewed, setWarningsViewed, lastWarningUpdate, setLastWarningUpdate}}>\r\n      {children}\r\n    </WarningsUpdateContext.Provider>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}