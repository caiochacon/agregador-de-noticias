{"ast":null,"code":"var _jsxFileName = \"C:\\\\aria\\\\cicc-app\\\\front-end\\\\src\\\\components\\\\modals\\\\LocationTrackingModal\\\\LocationTrackingModal.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport { Modal, ModalBody, ModalHeader, Col, Row, Card, CardBody, Spinner } from 'reactstrap';\nimport { RiPoliceCarFill, RiRadioFill, RiMapPin3Fill } from \"react-icons/ri\";\nimport { TbLetterA, TbLetterB, TbLetterC, TbLetterD, TbLetterE } from \"react-icons/tb\";\nimport { GoogleMap, InfoWindow, OverlayView } from \"@react-google-maps/api\";\nimport mapOptions from 'common/mapOptions.js';\nimport Tabs from \"components/Tabs\";\nimport TableLoading from \"components/tables/TableLoading\";\nimport { convertUtcToBrazilianDate } from \"common/utils/validate\";\nimport useAsync from \"common/hooks/useAsync\";\nimport { isEmpty } from \"common/utils/collections\";\nimport readVehicleLocations from \"axios/ReadVehicleLocations\";\nimport readPoliceCarLocations from \"axios/ReadPoliceCarLocations\";\nimport { EVENT_CREATION_TIMESTAMP } from \"common/model/Event\";\nimport { EVENT_LATITUDE } from \"common/model/Event\";\nimport { EVENT_LONGITUDE } from \"common/model/Event\";\nimport { EVENT_LOCAL } from \"common/model/Event\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst VEHICLE_TYPE = {\n  COMMON: 0,\n  POLICE: 1\n};\nconst containerStyle = {\n  width: 'auto',\n  height: '600px'\n};\nexport default function LocationTrackingModal(_ref) {\n  _s();\n\n  let {\n    show,\n    toggle,\n    data,\n    fetchData,\n    googleMapOnLoad,\n    googleMapOnError\n  } = _ref;\n  console.log('VEHICLE', data);\n  const [zoom, setZoom] = React.useState(11);\n  const tabs = ['Trajeto do Veículo', 'Posições das Viaturas', 'Posições dos Rádios'];\n  const [tabIndex, setTabIndex] = React.useState(0);\n  const [selectedIndex, setSelectedIndex] = React.useState();\n  const [mapData, setMapData] = React.useState([]);\n  const [vehicleData, setVehicleData] = React.useState([]);\n  const [policeCarData, setPoliceCarData] = React.useState([]);\n  const [radioData, setRadioData] = React.useState([]);\n  const [makerTooltipData, setMakerTooltipData] = React.useState({});\n  const [isMarkerTooltipActive, setIsMarkerTooltipActive] = React.useState(false);\n  const [mapLastClick, setMapLastClick] = React.useState(0);\n  const {\n    readVehicleLocationsRequest\n  } = readVehicleLocations();\n  const {\n    readPoliceCarLocationsRequest\n  } = readPoliceCarLocations();\n  const vehiclePlate = data.plate;\n  const currentLocation = data.location;\n  const {\n    loading: vehicleLoading,\n    error: vehicleError\n  } = useAsync(async () => {\n    if (!isEmpty(vehiclePlate)) {\n      let vehicleLastLocations = await readVehicleLocationsRequest(vehiclePlate);\n      processVehiclesData(vehicleLastLocations);\n    }\n\n    return true;\n  }, [fetchData]);\n  const {\n    loading: policeLoading,\n    error: policeError\n  } = useAsync(async () => {\n    let policeLastLocations = await readPoliceCarLocationsRequest();\n    processPoliceCarData(policeLastLocations);\n    return true;\n  }, [fetchData]);\n\n  function createPositionData(lat, lng, timestamp, local, direction, type, id, rotation, tooltipText, label, description) {\n    let formatedDirection = direction;\n\n    if (direction === null || direction === undefined || direction === \"\" || direction === \"na\") {\n      formatedDirection = \" - \";\n    }\n\n    return {\n      lat: lat,\n      lng: lng,\n      local: local,\n      direction: formatedDirection,\n      timestamp: timestamp,\n      type: type,\n      id: id,\n      rotation: rotation,\n      tooltipText: tooltipText,\n      label: label,\n      description: description\n    };\n  }\n\n  function processPoliceCarData(data) {\n    let radioIndex = 0;\n    let policeCarIndex = 0;\n    const locations = [];\n    let policeCarsPositions = [];\n    let radioPositions = [];\n\n    if (data && data.length > 0) {\n      data.forEach((dataItem, index) => {\n        let key = dataItem.police_car_lat + \"---\" + dataItem.police_car_lng;\n        let count = locations.filter(x => x === key).length;\n        let timestamp = convertUtcToBrazilianDate(dataItem.police_car_modification_date);\n        let tooltipText = createTooltipText(timestamp, dataItem.police_car_description, dataItem.police_car_id);\n\n        if (dataItem.police_car_id && dataItem.police_car_id[0] === '1') {\n          radioIndex += 1;\n          let positionValue = createPositionData(dataItem.police_car_lat, dataItem.police_car_lng, timestamp, \"\", \"\", VEHICLE_TYPE.POLICE, dataItem.police_car_id, count, tooltipText, radioIndex, dataItem.police_car_description);\n          radioPositions.push(positionValue);\n        } else {\n          policeCarIndex += 1;\n          let positionValue = createPositionData(dataItem.police_car_lat, dataItem.police_car_lng, timestamp, \"\", \"\", VEHICLE_TYPE.POLICE, dataItem.police_car_id, count, tooltipText, policeCarIndex, dataItem.police_car_description);\n          policeCarsPositions.push(positionValue);\n        }\n\n        locations.push(key);\n      });\n    }\n\n    setPoliceCarData(policeCarsPositions);\n    setRadioData(radioPositions);\n  }\n\n  function processVehiclesData(data) {\n    const locations = [];\n    const vehicle_path = [];\n\n    if (data && data.length > 0) {\n      data.forEach((dataItem, index) => {\n        if (!isEmpty(dataItem[EVENT_CREATION_TIMESTAMP])) {\n          let key = dataItem[EVENT_LATITUDE] + \"---\" + dataItem[EVENT_LONGITUDE];\n          let count = locations.filter(x => x === key).length;\n          let label = String.fromCharCode(97 + index).toUpperCase(); // Usando letras como label\n\n          let diff = 0.0001 * count;\n          let timestamp = convertUtcToBrazilianDate(dataItem[EVENT_CREATION_TIMESTAMP]);\n          let tooltipText = createTooltipText(timestamp, '', '');\n          let positionData = createPositionData(dataItem[EVENT_LATITUDE], dataItem[EVENT_LONGITUDE] - diff, timestamp, dataItem[EVENT_LOCAL], dataItem.evento_infevento_tpsentido, VEHICLE_TYPE.COMMON, vehiclePlate, count, tooltipText, label);\n          vehicle_path.push(positionData);\n          locations.push(key);\n\n          if (dataItem[EVENT_LOCAL] === currentLocation) {\n            setMapData({ ...mapData,\n              index: 0\n            });\n          }\n        }\n      });\n      let lastEvent = data[0];\n\n      if (!isEmpty(lastEvent) && lastEvent[EVENT_LATITUDE] && lastEvent[EVENT_LONGITUDE]) {\n        setMapData({ ...mapData,\n          lat: lastEvent[EVENT_LATITUDE],\n          lng: lastEvent[EVENT_LONGITUDE]\n        });\n        setVehicleData(vehicle_path);\n      }\n    }\n  }\n\n  function createTooltipText(timestamp, text, policeCarId) {\n    let [date, hour] = timestamp.split(\" \");\n\n    if (text !== '') {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: [\"\".concat(policeCarId[0] === '1' ? \"Rádio Portátil\" : \"Viatura\", \"\\n\"), \": \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 9\n        }, this), \"\".concat(text === null ? \"\" : text, \"\\n\"), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 114\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 120\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 127\n        }, this), /*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Data: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 9\n        }, this), \" \", \"\".concat(date, \"\\n\"), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 36\n        }, this), /*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Hora: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 9\n        }, this), \" \", \"\".concat(hour, \"\\n\"), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 36\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 15\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Data: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 9\n        }, this), \" \", \"\".concat(date, \"\\n\"), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 36\n        }, this), /*#__PURE__*/_jsxDEV(\"b\", {\n          children: \"Hora: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 9\n        }, this), \" \", \"\".concat(hour, \"\\n\"), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 36\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 15\n      }, this);\n    }\n  }\n\n  const getPositionDataArray = () => {\n    return [...vehicleData, ...policeCarData, ...radioData];\n  };\n\n  const ChangeInfoWindow = movimento => {\n    setMapData({ ...mapData,\n      lat: movimento.lat,\n      lng: movimento.lng\n    });\n    setMakerTooltipData(movimento.tooltipText);\n    setIsMarkerTooltipActive(true);\n    setZoom(13);\n  };\n\n  const OnCloseTooltipWindow = () => {\n    setIsMarkerTooltipActive(false);\n    setZoom(11);\n  };\n\n  function sumObjectsByKey() {\n    for (var _len = arguments.length, objs = new Array(_len), _key = 0; _key < _len; _key++) {\n      objs[_key] = arguments[_key];\n    }\n\n    return objs.reduce((a, b) => {\n      for (let k in b) {\n        a[k] = (a[k] || 0) + b[k];\n      }\n\n      return a;\n    }, {});\n  }\n\n  const getIcon = (index, positionData, positionList) => {\n    if (index === 0) {\n      return /*#__PURE__*/_jsxDEV(TbLetterA, {\n        className: \"map-icon\",\n        onClick: () => {\n          ChangeInfoWindow(positionData);\n          setMapLastClick(index);\n        },\n        style: {\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 14\n      }, this);\n    } else if (index === 1) {\n      return /*#__PURE__*/_jsxDEV(TbLetterB, {\n        className: \"map-icon\",\n        onClick: () => {\n          ChangeInfoWindow(positionData);\n          setMapLastClick(index);\n        },\n        style: {\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 14\n      }, this);\n    } else if (index === 2) {\n      return /*#__PURE__*/_jsxDEV(TbLetterC, {\n        className: \"map-icon\",\n        onClick: () => {\n          ChangeInfoWindow(positionData);\n          setMapLastClick(index);\n        },\n        style: {\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 14\n      }, this);\n    } else if (index === 3) {\n      return /*#__PURE__*/_jsxDEV(TbLetterD, {\n        className: \"map-icon\",\n        onClick: () => {\n          ChangeInfoWindow(positionData);\n          setMapLastClick(index);\n        },\n        style: {\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 14\n      }, this);\n    } else if (index === 4) {\n      return /*#__PURE__*/_jsxDEV(TbLetterE, {\n        className: \"map-icon\",\n        onClick: () => {\n          ChangeInfoWindow(positionData);\n          setMapLastClick(index);\n        },\n        style: {\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 14\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(RiMapPin3Fill, {\n        className: \"map-icon\",\n        style: {\n          fontSize: \"2.75rem\",\n          transform: \"translate(-50%, -45%)\",\n          color: \"#e61a1a\",\n          zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 7\n      }, this)\n    }, void 0, false);\n  };\n\n  const getVehiclePositionIcon = (index, positionData, positionList) => {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [getIcon(index, positionData, positionList), /*#__PURE__*/_jsxDEV(RiMapPin3Fill, {\n        className: \"map-icon\",\n        style: {\n          fontSize: \"2.75rem\",\n          transform: \"translate(-50%, -45%)\",\n          color: \"#e61a1a\",\n          zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true);\n  };\n\n  const PositionTooltip = () => {\n    return /*#__PURE__*/_jsxDEV(InfoWindow, {\n      position: sumObjectsByKey({\n        'lat': mapData['lat'],\n        'lng': mapData['lng']\n      }, {\n        'lat': 0.002,\n        'lng': 0\n      }),\n      onCloseClick: OnCloseTooltipWindow,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [makerTooltipData, /*#__PURE__*/_jsxDEV(\"a\", {\n          href: \"https://www.google.com/maps/search/\".concat(mapData.lat, \",\").concat(mapData.lng),\n          target: \"_blank\",\n          rel: \"noreferrer\",\n          children: \"Google Maps\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 10\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 7\n    }, this);\n  };\n\n  const getModalHeader = () => {\n    if (vehicleLoading || policeLoading) {\n      return \"CARREGANDO LOCALIZA\\xC7\\xD5ES VE\\xCDCULO \".concat(data.plate);\n    }\n\n    if (vehicleError || policeError) {\n      return \"ERRO\";\n    }\n\n    if (isEmpty(vehicleData)) {\n      return \"VE\\xCDCULO \".concat(data.plate, \" SEM PERCURSO REGISTRADO\");\n    }\n\n    if (!isEmpty(vehicleData)) {\n      return \"PERCURSO DO VE\\xCDCULO \".concat(data.plate);\n    }\n  };\n\n  const PositionTable = () => {\n    let offset = 0; //O offset é necessário pois os pins são adicionados na seguinte order:  vehicle -> policecar -> radio. Se não for setado o offset, na hora de clicar nas linhas da tabela será destacado o pin errado\n\n    let tableData = vehicleData;\n\n    if (tabIndex === 1) {\n      tableData = policeCarData;\n      offset = vehicleData.length;\n    } else if (tabIndex === 2) {\n      tableData = radioData;\n      offset = vehicleData.length + policeCarData.length;\n    }\n\n    return /*#__PURE__*/_jsxDEV(TableLoading, {\n      loading: false,\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"#\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 370,\n            columnNumber: 11\n          }, this), tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"ID R\\xE1dio\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 27\n          }, this) : null, tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Descri\\xE7\\xE3o\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 27\n          }, this) : null, tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Atualizado em\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 27\n          }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Passagem\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 29\n          }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Local\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 29\n          }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Sentido\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 377,\n            columnNumber: 29\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: tableData.length > 0 && tableData.map((positionData, index) => {\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            onClick: () => {\n              setSelectedIndex(index + offset);\n              setMapData({ ...mapData,\n                lat: positionData.lat,\n                lng: positionData.lng\n              });\n              OnCloseTooltipWindow();\n              setMapLastClick(index);\n            },\n            style: (mapLastClick >= 0 ? mapLastClick : data.localDefault) === index ? {\n              backgroundColor: 'rgba(128, 128, 128, 0.7)'\n            } : {},\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.label\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 13\n            }, this), tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 390,\n              columnNumber: 29\n            }, this) : null, tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 391,\n              columnNumber: 29\n            }, this) : null, tabIndex > 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.timestamp\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 392,\n              columnNumber: 29\n            }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.timestamp\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 394,\n              columnNumber: 31\n            }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.local\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 31\n            }, this) : null, tabIndex === 0 ? /*#__PURE__*/_jsxDEV(\"td\", {\n              children: positionData.local\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 396,\n              columnNumber: 31\n            }, this) : null]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 19\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 12\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Modal, {\n    isOpen: show,\n    toggle: toggle,\n    style: {\n      maxWidth: '80%'\n    },\n    children: [/*#__PURE__*/_jsxDEV(ModalHeader, {\n      toggle: toggle,\n      children: getModalHeader()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(ModalBody, {\n      style: {\n        background: \"#f2f2f2\"\n      },\n      children: [vehicleLoading || policeLoading ? /*#__PURE__*/_jsxDEV(Spinner, {\n        color: \"info\",\n        style: {\n          width: \"4.0rem\",\n          height: \"4.0rem\",\n          margin: '4.0rem'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 44\n      }, this) : \"\", vehicleError || policeError ? /*#__PURE__*/_jsxDEV(\"h1\", {\n        color: \"info\",\n        children: \"N\\xE3o foi poss\\xEDvel recuperar os dados de Ve\\xEDculo/Viaturas. \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 38\n      }, this) : \"\", googleMapOnError && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"N\\xE3o foi poss\\xEDvel carregar o GoogleMap.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 28\n      }, this), !vehicleLoading && !policeLoading && googleMapOnLoad ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            md: \"12\",\n            children: /*#__PURE__*/_jsxDEV(GoogleMap, {\n              mapContainerStyle: containerStyle,\n              center: {\n                lat: mapData.lat,\n                lng: mapData.lng\n              },\n              zoom: zoom,\n              defaultZoom: 5,\n              options: mapOptions,\n              children: [getPositionDataArray().length > 0 && getPositionDataArray()[0].local && getPositionDataArray().map((positionData, index) => {\n                const positionList = getPositionDataArray();\n                return /*#__PURE__*/_jsxDEV(OverlayView, {\n                  className: \"map-icon\",\n                  position: {\n                    lat: positionData.lat,\n                    lng: positionData.lng\n                  },\n                  mapPaneName: OverlayView.OVERLAY_MOUSE_TARGET,\n                  children: positionData.type === 0 ? getVehiclePositionIcon(index, positionData, positionList) : positionData.id[0] === '1' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: [/*#__PURE__*/_jsxDEV(RiRadioFill, {\n                      className: \"map-icon\",\n                      onClick: () => {\n                        ChangeInfoWindow(positionData);\n                        setMapLastClick(index);\n                      },\n                      style: {\n                        color: index === selectedIndex ? '#f2f229' : \"#030202\",\n                        zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 439,\n                      columnNumber: 31\n                    }, this), /*#__PURE__*/_jsxDEV(RiMapPin3Fill, {\n                      className: \"map-icon\",\n                      style: {\n                        fontSize: \"2.75rem\",\n                        transform: \"translate(-50%, -45%)\",\n                        color: \"#669966\",\n                        zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 447,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                    children: [/*#__PURE__*/_jsxDEV(RiPoliceCarFill, {\n                      className: \"map-icon\",\n                      onClick: () => {\n                        ChangeInfoWindow(positionData);\n                        setMapLastClick(index);\n                      },\n                      style: {\n                        color: index === selectedIndex ? '#f2f229' : \"#030202\",\n                        zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 460,\n                      columnNumber: 31\n                    }, this), /*#__PURE__*/_jsxDEV(RiMapPin3Fill, {\n                      className: \"map-icon\",\n                      style: {\n                        fontSize: \"2.75rem\",\n                        transform: \"translate(-50%, -40%)\",\n                        color: \"#4466bb\",\n                        zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 468,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true)\n                }, \"marker-\".concat(index), false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 426,\n                  columnNumber: 21\n                }, this);\n              }), isMarkerTooltipActive && /*#__PURE__*/_jsxDEV(PositionTooltip, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 483,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 415,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          style: {\n            marginTop: \"1.5rem\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            md: \"12\",\n            children: [/*#__PURE__*/_jsxDEV(Tabs, {\n              names: tabs,\n              index: [tabIndex, setTabIndex]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 489,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(Card, {\n              className: \"card\",\n              style: {\n                borderTopLeftRadius: '0px'\n              },\n              children: /*#__PURE__*/_jsxDEV(CardBody, {\n                children: /*#__PURE__*/_jsxDEV(PositionTable, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 492,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 491,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 490,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true) : \"\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 404,\n    columnNumber: 10\n  }, this);\n}\n\n_s(LocationTrackingModal, \"lg5EsfdNCegXVh33qSyRLRrbydg=\", false, function () {\n  return [useAsync, useAsync];\n});\n\n_c = LocationTrackingModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"LocationTrackingModal\");","map":{"version":3,"sources":["C:/aria/cicc-app/front-end/src/components/modals/LocationTrackingModal/LocationTrackingModal.js"],"names":["React","Modal","ModalBody","ModalHeader","Col","Row","Card","CardBody","Spinner","RiPoliceCarFill","RiRadioFill","RiMapPin3Fill","TbLetterA","TbLetterB","TbLetterC","TbLetterD","TbLetterE","GoogleMap","InfoWindow","OverlayView","mapOptions","Tabs","TableLoading","convertUtcToBrazilianDate","useAsync","isEmpty","readVehicleLocations","readPoliceCarLocations","EVENT_CREATION_TIMESTAMP","EVENT_LATITUDE","EVENT_LONGITUDE","EVENT_LOCAL","VEHICLE_TYPE","COMMON","POLICE","containerStyle","width","height","LocationTrackingModal","show","toggle","data","fetchData","googleMapOnLoad","googleMapOnError","console","log","zoom","setZoom","useState","tabs","tabIndex","setTabIndex","selectedIndex","setSelectedIndex","mapData","setMapData","vehicleData","setVehicleData","policeCarData","setPoliceCarData","radioData","setRadioData","makerTooltipData","setMakerTooltipData","isMarkerTooltipActive","setIsMarkerTooltipActive","mapLastClick","setMapLastClick","readVehicleLocationsRequest","readPoliceCarLocationsRequest","vehiclePlate","plate","currentLocation","location","loading","vehicleLoading","error","vehicleError","vehicleLastLocations","processVehiclesData","policeLoading","policeError","policeLastLocations","processPoliceCarData","createPositionData","lat","lng","timestamp","local","direction","type","id","rotation","tooltipText","label","description","formatedDirection","undefined","radioIndex","policeCarIndex","locations","policeCarsPositions","radioPositions","length","forEach","dataItem","index","key","police_car_lat","police_car_lng","count","filter","x","police_car_modification_date","createTooltipText","police_car_description","police_car_id","positionValue","push","vehicle_path","String","fromCharCode","toUpperCase","diff","positionData","evento_infevento_tpsentido","lastEvent","text","policeCarId","date","hour","split","getPositionDataArray","ChangeInfoWindow","movimento","OnCloseTooltipWindow","sumObjectsByKey","objs","reduce","a","b","k","getIcon","positionList","color","zIndex","fontSize","transform","getVehiclePositionIcon","PositionTooltip","getModalHeader","PositionTable","offset","tableData","map","localDefault","backgroundColor","maxWidth","background","margin","OVERLAY_MOUSE_TARGET","marginTop","borderTopLeftRadius"],"mappings":"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","sourcesContent":["import React from \"react\"; import {\r\n  Modal,\r\n  ModalBody,\r\n  ModalHeader,\r\n  Col,\r\n  Row,\r\n  Card,\r\n  CardBody,\r\n  Spinner\r\n} from 'reactstrap';\r\nimport { RiPoliceCarFill, RiRadioFill, RiMapPin3Fill } from \"react-icons/ri\"\r\nimport { TbLetterA, TbLetterB, TbLetterC, TbLetterD, TbLetterE } from \"react-icons/tb\";\r\n\r\nimport { GoogleMap, InfoWindow, OverlayView } from \"@react-google-maps/api\";\r\nimport mapOptions from 'common/mapOptions.js'\r\nimport Tabs from \"components/Tabs\";\r\nimport TableLoading from \"components/tables/TableLoading\";\r\nimport { convertUtcToBrazilianDate } from \"common/utils/validate\";\r\nimport useAsync from \"common/hooks/useAsync\";\r\nimport { isEmpty } from \"common/utils/collections\";\r\nimport readVehicleLocations from \"axios/ReadVehicleLocations\";\r\nimport readPoliceCarLocations from \"axios/ReadPoliceCarLocations\";\r\nimport { EVENT_CREATION_TIMESTAMP } from \"common/model/Event\";\r\nimport { EVENT_LATITUDE } from \"common/model/Event\";\r\nimport { EVENT_LONGITUDE } from \"common/model/Event\";\r\nimport { EVENT_LOCAL } from \"common/model/Event\";\r\n\r\n\r\nconst VEHICLE_TYPE = {\r\n  COMMON: 0,\r\n  POLICE: 1\r\n}\r\n\r\n\r\nconst containerStyle = {\r\n  width: 'auto',\r\n  height: '600px'\r\n};\r\n\r\n\r\n\r\nexport default function LocationTrackingModal({ show, toggle, data, fetchData, googleMapOnLoad, googleMapOnError }) {\r\n\r\n  console.log('VEHICLE', data)\r\n\r\n  const [zoom, setZoom] = React.useState(11)\r\n  const tabs = ['Trajeto do Veículo', 'Posições das Viaturas', 'Posições dos Rádios']\r\n  const [tabIndex, setTabIndex] = React.useState(0)\r\n  const [selectedIndex, setSelectedIndex] = React.useState()\r\n\r\n  const [mapData, setMapData] = React.useState([])\r\n  const [vehicleData, setVehicleData] = React.useState([])\r\n  const [policeCarData, setPoliceCarData] = React.useState([])\r\n  const [radioData, setRadioData] = React.useState([])\r\n\r\n  const [makerTooltipData, setMakerTooltipData] = React.useState({})\r\n  const [isMarkerTooltipActive, setIsMarkerTooltipActive] = React.useState(false)\r\n  const [mapLastClick, setMapLastClick] = React.useState(0)\r\n\r\n  const { readVehicleLocationsRequest } = readVehicleLocations()\r\n  const { readPoliceCarLocationsRequest } = readPoliceCarLocations()\r\n\r\n  const vehiclePlate = data.plate\r\n  const currentLocation = data.location\r\n\r\n\r\n  const { loading: vehicleLoading, error: vehicleError } = useAsync(async () => {\r\n\r\n    if (!isEmpty(vehiclePlate)) {\r\n      let vehicleLastLocations = await readVehicleLocationsRequest(vehiclePlate)\r\n      processVehiclesData(vehicleLastLocations)\r\n    }\r\n    return true\r\n  }, [fetchData]);\r\n\r\n\r\n  const { loading: policeLoading, error: policeError  } = useAsync(async () => {\r\n\r\n    let policeLastLocations = await readPoliceCarLocationsRequest()\r\n    processPoliceCarData(policeLastLocations)\r\n\r\n    return true\r\n  }, [fetchData]);\r\n\r\n\r\n\r\n  function createPositionData(lat, lng, timestamp, local, direction, type, id, rotation, tooltipText, label, description) {\r\n    let formatedDirection = direction\r\n    if (direction === null || direction === undefined || direction === \"\" || direction === \"na\") {\r\n      formatedDirection = \" - \"\r\n    }\r\n    return { lat: lat, lng: lng, local: local, direction: formatedDirection, timestamp: timestamp, type: type, id: id, rotation: rotation, tooltipText: tooltipText, label: label, description: description }\r\n  }\r\n\r\n\r\n  function processPoliceCarData(data) {\r\n\r\n    let radioIndex = 0\r\n    let policeCarIndex = 0\r\n\r\n    const locations = []\r\n    let policeCarsPositions = []\r\n    let radioPositions = []\r\n\r\n    if (data && data.length > 0) {\r\n      data.forEach((dataItem, index) => {\r\n        let key = dataItem.police_car_lat + \"---\" + dataItem.police_car_lng\r\n        let count = locations.filter(x => x === key).length\r\n        let timestamp = convertUtcToBrazilianDate(dataItem.police_car_modification_date)\r\n\r\n        let tooltipText = createTooltipText(timestamp, dataItem.police_car_description, dataItem.police_car_id)\r\n\r\n        if (dataItem.police_car_id && dataItem.police_car_id[0] === '1') {\r\n          radioIndex += 1\r\n          let positionValue = createPositionData(dataItem.police_car_lat, dataItem.police_car_lng,\r\n            timestamp, \"\", \"\", VEHICLE_TYPE.POLICE, dataItem.police_car_id, count, tooltipText, radioIndex, dataItem.police_car_description)\r\n          radioPositions.push(positionValue)\r\n        } else {\r\n          policeCarIndex += 1\r\n          let positionValue = createPositionData(dataItem.police_car_lat, dataItem.police_car_lng,\r\n            timestamp, \"\", \"\", VEHICLE_TYPE.POLICE, dataItem.police_car_id, count, tooltipText, policeCarIndex, dataItem.police_car_description)\r\n          policeCarsPositions.push(positionValue)\r\n        }\r\n\r\n        locations.push(key)\r\n\r\n      })\r\n    }\r\n\r\n    setPoliceCarData(policeCarsPositions)\r\n    setRadioData(radioPositions)\r\n\r\n  }\r\n\r\n  function processVehiclesData(data) {\r\n\r\n    const locations = []\r\n    const vehicle_path = []\r\n\r\n\r\n    if (data && data.length > 0) {\r\n\r\n      data.forEach((dataItem, index) => {\r\n        if (!isEmpty(dataItem[EVENT_CREATION_TIMESTAMP])) {\r\n\r\n          \r\n          let key = dataItem[EVENT_LATITUDE] + \"---\" + dataItem[EVENT_LONGITUDE]\r\n          let count = locations.filter(x => x === key).length\r\n          let label = String.fromCharCode(97 + index).toUpperCase() // Usando letras como label\r\n\r\n          let diff = 0.0001 * count\r\n          let timestamp = convertUtcToBrazilianDate(dataItem[EVENT_CREATION_TIMESTAMP])\r\n          let tooltipText = createTooltipText(timestamp, '', '')\r\n          let positionData = createPositionData(dataItem[EVENT_LATITUDE], dataItem[EVENT_LONGITUDE] - diff,\r\n            timestamp, dataItem[EVENT_LOCAL], dataItem.evento_infevento_tpsentido, VEHICLE_TYPE.COMMON, vehiclePlate, count, tooltipText, label)\r\n\r\n\r\n          vehicle_path.push(positionData)\r\n\r\n          locations.push(key)\r\n          if (dataItem[EVENT_LOCAL] === currentLocation) {\r\n            setMapData({ ...mapData, index: 0 })\r\n          }\r\n        }\r\n      })\r\n\r\n      let lastEvent = data[0]\r\n      if (!isEmpty(lastEvent) && lastEvent[EVENT_LATITUDE] && lastEvent[EVENT_LONGITUDE]) {\r\n        setMapData({\r\n          ...mapData,\r\n          lat: lastEvent[EVENT_LATITUDE],\r\n          lng: lastEvent[EVENT_LONGITUDE]\r\n        })\r\n\r\n\r\n        setVehicleData(vehicle_path)\r\n      }\r\n\r\n\r\n    }\r\n  }\r\n\r\n\r\n  function createTooltipText(timestamp, text, policeCarId) {\r\n    let [date, hour] = timestamp.split(\" \")\r\n\r\n    if (text !== '') {\r\n      return (<div className=\"text-center\" >\r\n        <b>{`${policeCarId[0] === '1' ? \"Rádio Portátil\" : \"Viatura\"}\\n`}: </b>{`${text === null ? \"\" : text}\\n`}<br /><br /> <br />\r\n        <b>Data: </b> {`${date}\\n`}<br />\r\n        <b>Hora: </b> {`${hour}\\n`}<br />\r\n      </div>\r\n      )\r\n    } else {\r\n      return (<div className=\"text-center\" >\r\n        <b>Data: </b> {`${date}\\n`}<br />\r\n        <b>Hora: </b> {`${hour}\\n`}<br />\r\n      </div>\r\n      )\r\n    }\r\n  }\r\n\r\n\r\n  const getPositionDataArray = () => {\r\n    return [...vehicleData, ...policeCarData, ...radioData];\r\n  }\r\n\r\n  const ChangeInfoWindow = (movimento) => {\r\n\r\n    setMapData({ ...mapData, lat: movimento.lat, lng: movimento.lng })\r\n\r\n    setMakerTooltipData(movimento.tooltipText)\r\n    setIsMarkerTooltipActive(true)\r\n    setZoom(13)\r\n  }\r\n\r\n  const OnCloseTooltipWindow = () => {\r\n    setIsMarkerTooltipActive(false)\r\n    setZoom(11)\r\n  }\r\n\r\n\r\n  function sumObjectsByKey(...objs) {\r\n    return objs.reduce((a, b) => {\r\n      for (let k in b) {\r\n        a[k] = (a[k] || 0) + b[k]\r\n      }\r\n      return a;\r\n    }, {});\r\n  }\r\n\r\n\r\n\r\n  const getIcon = (index, positionData, positionList) => {\r\n\r\n    if (index === 0) {\r\n      return <TbLetterA\r\n        className=\"map-icon\"\r\n        onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n        style={{\r\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\r\n        }}\r\n      />\r\n    } else if (index === 1) {\r\n      return <TbLetterB\r\n        className=\"map-icon\"\r\n        onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n        style={{\r\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\r\n        }}\r\n      />\r\n    } else if (index === 2) {\r\n      return <TbLetterC\r\n        className=\"map-icon\"\r\n        onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n        style={{\r\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\r\n        }}\r\n      />\r\n\r\n    } else if (index === 3) {\r\n      return <TbLetterD\r\n        className=\"map-icon\"\r\n        onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n        style={{\r\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\r\n        }}\r\n      />\r\n    } else if (index === 4) {\r\n      return <TbLetterE\r\n        className=\"map-icon\"\r\n        onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n        style={{\r\n          color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1\r\n        }}\r\n      />\r\n    }\r\n    return <>\r\n      <RiMapPin3Fill\r\n        className=\"map-icon\"\r\n        style={{\r\n          fontSize: \"2.75rem\",\r\n          transform: \"translate(-50%, -45%)\",\r\n          color: \"#e61a1a\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\r\n        }}\r\n      />\r\n    </>\r\n  }\r\n\r\n  const getVehiclePositionIcon = (index, positionData, positionList) => {\r\n\r\n    return <>\r\n      {getIcon(index, positionData, positionList)}\r\n\r\n      <RiMapPin3Fill\r\n        className=\"map-icon\"\r\n        style={{\r\n          fontSize: \"2.75rem\",\r\n          transform: \"translate(-50%, -45%)\",\r\n          color: \"#e61a1a\",\r\n          zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\r\n        }}\r\n      />\r\n    </>\r\n  }\r\n\r\n\r\n  const PositionTooltip = () => {\r\n\r\n    return (\r\n      <InfoWindow\r\n        position={sumObjectsByKey({ 'lat': mapData['lat'], 'lng': mapData['lng'] }, { 'lat': 0.002, 'lng': 0 })}\r\n        onCloseClick={OnCloseTooltipWindow}\r\n      >\r\n        {<div className=\"text-center\">\r\n          {makerTooltipData}\r\n          <a\r\n            href={`https://www.google.com/maps/search/${mapData.lat},${mapData.lng}`} target=\"_blank\"\r\n            rel=\"noreferrer\"\r\n          >\r\n            Google Maps\r\n          </a>\r\n        </div>}\r\n      </InfoWindow>\r\n    )\r\n  }\r\n\r\n  const getModalHeader = () => {\r\n\r\n    if (vehicleLoading || policeLoading ){\r\n      return `CARREGANDO LOCALIZAÇÕES VEÍCULO ${data.plate}`\r\n    } \r\n\r\n    if (vehicleError || policeError ){\r\n      return `ERRO`\r\n    } \r\n\r\n    if (isEmpty(vehicleData) ){\r\n      return `VEÍCULO ${data.plate} SEM PERCURSO REGISTRADO`\r\n    }\r\n\r\n    if (!isEmpty(vehicleData) ){\r\n      return `PERCURSO DO VEÍCULO ${data.plate}`\r\n    }\r\n\r\n\r\n\r\n  }\r\n  \r\n  const PositionTable = () => {\r\n    let offset = 0 //O offset é necessário pois os pins são adicionados na seguinte order:  vehicle -> policecar -> radio. Se não for setado o offset, na hora de clicar nas linhas da tabela será destacado o pin errado\r\n    let tableData = vehicleData\r\n    if (tabIndex === 1) {\r\n      tableData = policeCarData\r\n      offset = vehicleData.length\r\n    } else if (tabIndex === 2) {\r\n      tableData = radioData\r\n      offset = vehicleData.length + policeCarData.length\r\n    }\r\n\r\n    return <TableLoading loading={false}>\r\n      <thead>\r\n        <tr>\r\n          <th>#</th>\r\n          {tabIndex > 0 ? <th>ID Rádio</th> : null}\r\n          {tabIndex > 0 ? <th>Descrição</th> : null}\r\n          {tabIndex > 0 ? <th>Atualizado em</th> : null}\r\n\r\n          {tabIndex === 0 ? <th>Passagem</th> : null}\r\n          {tabIndex === 0 ? <th>Local</th> : null}\r\n          {tabIndex === 0 ? <th>Sentido</th> : null}\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {tableData.length > 0 && tableData.map((positionData, index) => {\r\n\r\n          return (<tr key={index}\r\n\r\n            onClick={() => { setSelectedIndex(index + offset); setMapData({ ...mapData, lat: positionData.lat, lng: positionData.lng }); OnCloseTooltipWindow(); setMapLastClick(index) }}\r\n\r\n            style={(mapLastClick >= 0 ? mapLastClick : data.localDefault) === index ? { backgroundColor: 'rgba(128, 128, 128, 0.7)' } : {}}>\r\n            <td>{positionData.label}</td>\r\n\r\n            {tabIndex > 0 ? <td>{positionData.id}</td> : null}\r\n            {tabIndex > 0 ? <td>{positionData.description}</td> : null}\r\n            {tabIndex > 0 ? <td>{positionData.timestamp}</td> : null}\r\n\r\n            {tabIndex === 0 ? <td>{positionData.timestamp}</td> : null}\r\n            {tabIndex === 0 ? <td>{positionData.local}</td> : null}\r\n            {tabIndex === 0 ? <td>{positionData.local}</td> : null}\r\n          </tr>)\r\n\r\n        })}\r\n      </tbody>\r\n    </TableLoading>\r\n  }\r\n\r\n  return <Modal isOpen={show} toggle={toggle} style={{ maxWidth: '80%' }}>\r\n    <ModalHeader toggle={toggle}>\r\n      {getModalHeader()}\r\n    </ModalHeader>\r\n    <ModalBody style={{ background: \"#f2f2f2\" }}>\r\n      {(vehicleLoading || policeLoading) ? <Spinner color=\"info\" style={{ width: \"4.0rem\", height: \"4.0rem\", margin: '4.0rem' }} /> : \"\"}\r\n      {vehicleError || policeError ? <h1 color=\"info\" >Não foi possível recuperar os dados de Veículo/Viaturas. </h1> : \"\"}\r\n      {googleMapOnError && <div>Não foi possível carregar o GoogleMap.</div>}\r\n      {(!vehicleLoading && !policeLoading && googleMapOnLoad) ? <>\r\n        <Row>\r\n          <Col md=\"12\">\r\n            <GoogleMap\r\n              mapContainerStyle={containerStyle}\r\n              center={{ lat: mapData.lat, lng: mapData.lng }}\r\n              zoom={zoom}\r\n              defaultZoom={5}\r\n              options={mapOptions}\r\n            >\r\n              {getPositionDataArray().length > 0 && getPositionDataArray()[0].local\r\n                && getPositionDataArray().map((positionData, index) => {\r\n                  const positionList = getPositionDataArray()\r\n                  return (\r\n                    <OverlayView\r\n                      className=\"map-icon\"\r\n                      key={`marker-${index}`}\r\n                      position={{ lat: positionData.lat, lng: positionData.lng }}\r\n                      mapPaneName={OverlayView.OVERLAY_MOUSE_TARGET}\r\n                    >\r\n                      {\r\n                        positionData.type === 0 ?\r\n\r\n                          getVehiclePositionIcon(index, positionData, positionList)\r\n\r\n                          : (positionData.id[0] === '1' ?\r\n                            <>\r\n                              <RiRadioFill\r\n                                className=\"map-icon\"\r\n                                onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n                                style={{\r\n                                  color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n                                  zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1,\r\n                                }}\r\n                              />\r\n                              <RiMapPin3Fill\r\n                                className=\"map-icon\"\r\n                                style={{\r\n                                  fontSize: \"2.75rem\",\r\n                                  transform: \"translate(-50%, -45%)\",\r\n                                  color: \"#669966\",\r\n                                  zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\r\n                                }}\r\n                              />\r\n                            </>\r\n\r\n                            :\r\n                            <>\r\n                              <RiPoliceCarFill\r\n                                className=\"map-icon\"\r\n                                onClick={() => { ChangeInfoWindow(positionData); setMapLastClick(index) }}\r\n                                style={{\r\n                                  color: index === selectedIndex ? '#f2f229' : \"#030202\",\r\n                                  zIndex: index === selectedIndex ? 2 * positionList.length + 1 : index * 2 + 1,\r\n                                }}\r\n                              />\r\n                              <RiMapPin3Fill\r\n                                className=\"map-icon\"\r\n                                style={{\r\n                                  fontSize: \"2.75rem\",\r\n                                  transform: \"translate(-50%, -40%)\",\r\n                                  color: \"#4466bb\",\r\n                                  zIndex: index === selectedIndex ? 2 * positionList.length : index * 2\r\n                                }}\r\n                              />\r\n                            </>)\r\n                      }\r\n                    </OverlayView>\r\n                  )\r\n                })\r\n              }\r\n              {isMarkerTooltipActive && <PositionTooltip></PositionTooltip>}\r\n            </GoogleMap>\r\n          </Col>\r\n        </Row>\r\n        <Row style={{ marginTop: \"1.5rem\" }}>\r\n          <Col md=\"12\">\r\n            <Tabs names={tabs} index={[tabIndex, setTabIndex]} />\r\n            <Card className=\"card\" style={{ borderTopLeftRadius: '0px' }}>\r\n              <CardBody>\r\n                <PositionTable />\r\n              </CardBody>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </>\r\n        : \"\"}\r\n    </ModalBody>\r\n  </Modal>;\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}