{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rodri\\\\OneDrive\\\\Documentos\\\\cicc-app\\\\front-end\\\\src\\\\layouts\\\\Login.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport axios from 'axios';\nimport axiosRetry from 'axios-retry';\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\nimport { getRetryConfig } from \"axios/AxiosUtils\";\nimport { useHistory } from \"react-router-dom\";\nimport { Row, Col, Button, Form, FormGroup, Input, InputGroup, InputGroupAddon, InputGroupText, Spinner } from 'reactstrap';\nimport { RiUser3Fill, RiLockFill, RiCloseFill } from 'react-icons/ri';\nimport LoadingPage from \"layouts/Loading\";\nimport { MapsContext } from \"context/MapsContext\";\nimport { DashboardContext } from \"context/DashboardContext\";\nimport { WarningsContext } from \"context/WarningsContext\";\nimport { AuditorsContext } from \"context/AuditorsContext\";\nimport { GroupsContext } from \"context/GroupsContext\";\nimport { mountViews } from \"views/ViewsCreator\";\nimport GROUPS_ENUM from 'common/enumerators/GroupsEnum';\nimport logo from \"logo.svg\";\nimport env from \"common/enviroment\";\nimport routes from \"routes.js\";\nimport { isLoggedIn } from \"common/SessionUtils\";\nimport { createBaseHttpRequestBody } from \"axios/AxiosUtils\";\nimport { getUserLogin } from \"common/SessionUtils\";\nimport { getLDAPRoles } from \"common/SessionUtils\";\nimport { setUserID } from \"common/SessionUtils\";\nimport { setUserRegistrationID } from \"common/SessionUtils\";\nimport { setVisibilityGroups } from \"common/SessionUtils\";\nimport { setUserRole } from \"common/SessionUtils\";\nimport { setLDAPRoles } from \"common/SessionUtils\";\nimport { setJWT } from \"common/SessionUtils\";\nimport { setCortexToken } from \"common/SessionUtils\";\nimport { setUserLogin } from \"common/SessionUtils\";\nimport { setViewedWarnings } from \"common/SessionUtils\";\nimport { setNearClosingWarningModalEnabled, setPendingHomologationModalEnabled } from \"common/SessionUtils\";\nimport { setUserName } from \"common/SessionUtils\";\nimport { isComandoFiscal } from \"common/SessionUtils\";\nimport { setMonitoringChiefFlag } from \"common/SessionUtils\";\nimport { LOGIN } from \"axios/AxiosUtils\";\nimport { configureHttp } from \"axios/http/configure-http\";\nimport { WarningsUpdateContext } from \"context/WarningsUpdateContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function Login(props) {\n  _s();\n\n  const history = useHistory(); // Contorno dos inputs\n\n  const [userFocus, setUserFocus] = React.useState(false);\n  const [passFocus, setPassFocus] = React.useState(false);\n  const [isLoading, setLoading] = React.useState(false);\n  const [isGlobalLoading, setGlobalLoading] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [password, setPassword] = React.useState('');\n  const [message, setMessage] = React.useState('');\n\n  const onUserFocus = () => setUserFocus(!userFocus);\n\n  const onPassFocus = () => setPassFocus(!passFocus); // Contextos para extrair dados das telas\n\n\n  const {\n    getCamerasData\n  } = React.useContext(MapsContext);\n  const {\n    getDashboardData\n  } = React.useContext(DashboardContext);\n  const {\n    startSSE,\n    setWasReloaded\n  } = React.useContext(WarningsContext);\n  const {\n    startWarningsViewedSSE\n  } = React.useContext(WarningsUpdateContext);\n  const {\n    getAuditorsData\n  } = React.useContext(AuditorsContext);\n  const {\n    fetchGroupsData,\n    fetchGroupsName,\n    getGroupRegistry\n  } = React.useContext(GroupsContext);\n  const [loginProcessFinished, setLoginProcessFinished] = React.useState(false);\n  const axiosRetryProxy = axios.create(getTimeoutConfig(LOGIN));\n  axiosRetry(axiosRetryProxy, getRetryConfig());\n  React.useEffect(() => {\n    if (isLoggedIn()) {\n      setWasReloaded(false);\n      mountViews(routes);\n      setGlobalLoading(false);\n\n      if (isComandoFiscal()) {\n        history.push('/admin/notifications'); // Trocar de tela\n      } else {\n        history.push('/admin/tables'); // Trocar de tela\n      }\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [loginProcessFinished]);\n  Notification.requestPermission();\n\n  const login = async () => {\n    configureHttp();\n    setLoading(true);\n\n    if (await getToken()) {\n      setGlobalLoading(true);\n      await fetchGroupsData();\n\n      if (await loadUserData()) {\n        await fetchGroupsName();\n        await getAuditorsData(true);\n        startSSE();\n        startWarningsViewedSSE();\n        setLoginProcessFinished(true);\n      }\n    }\n\n    setLoading(false);\n  };\n\n  const loadUserData = async () => {\n    let roles = getLDAPRoles(); //Construir uma lista com grupos que o usuário logado tem visibilidade para ver. \n    //É um processo em passos. \n    //Primeiro, são carregados os grupos institucionais. Estes grupos virão do ldap. \n\n    const GRs = ['GR1', 'GR2', 'GR3', 'GR4', 'GR5', 'COE', 'ATIF', 'GECOF', 'GOFMT'];\n    let visibilityGroups = [GROUPS_ENUM.GERAL]; //Qualquer usuário logado ao sistema vai ter acesso ao grupo geral\n\n    if (localStorage.getItem('role') === \"GAECO\") {\n      visibilityGroups = [GROUPS_ENUM.GAECO];\n    } else if (localStorage.getItem('role') === \"DNIT\") {\n      visibilityGroups = [GROUPS_ENUM.DNIT];\n    } else if (localStorage.getItem('role') === \"PRF\") {\n      visibilityGroups = [GROUPS_ENUM.PRF];\n    }\n\n    GRs.forEach(group => {\n      if (roles.includes(group)) {\n        visibilityGroups.push(GROUPS_ENUM[group]);\n      }\n    });\n    const httpRequestBody = createBaseHttpRequestBody();\n    httpRequestBody['user_login'] = getUserLogin();\n    return await axiosRetryProxy.post(\"\".concat(env.apiAddress, \"/auditor/read\"), httpRequestBody).then(res => {\n      let data = res.data[0];\n\n      if (data['user_id']) {\n        setUserID(data['user_id']);\n        setUserRegistrationID(data['user_registration_id']);\n        setUserName(data['user_name']);\n        let groups = data['usuario_grupo']; //Segunda parte dos grupos, virá tabela usuario_grupo\n\n        for (const group of groups) {\n          visibilityGroups.push(group['group_id']);\n        } //Marcar se o usuário é chefe do grupo de monitoramento\n\n\n        let monitoramentoGroup = getGroupRegistry(GROUPS_ENUM.MONITORAMENTO);\n\n        if (monitoramentoGroup && monitoramentoGroup['group_owner_data'][0] && monitoramentoGroup['group_owner_data'][0]['user_login'] === getUserLogin()) {\n          setMonitoringChiefFlag(true);\n        }\n      }\n\n      return true;\n    }).catch(err => {\n      console.log(err);\n      return true;\n    }).finally(() => {\n      setVisibilityGroups(visibilityGroups);\n    });\n  };\n\n  const getToken = () => {\n    const httpRequestBody = {\n      'email': email,\n      'password': password\n    };\n    return axiosRetryProxy.post(\"\".concat(env.apiAddress, \"/login\"), httpRequestBody).then(res => {\n      if (res.data[\"code\"] === 200) {\n        const token = res.data[\"jwt_token\"];\n        const cortex_token = res.data[\"cortex_token\"];\n        let roles = res.data[\"groups\"];\n        console.log(\"ROLES\", roles, res.data);\n        let role = 'CICC';\n        const ROLES = ['ADMIN', 'SUBGERENTE', 'GAECO', 'PRF', 'DNIT', 'COE', 'GOFMT', 'GECOF', 'GOAC', 'ATIF', 'COMANDO', 'MONITORAMENTO', 'COMANDOFISCAL', 'OPERACIONAL', 'CICC'];\n\n        for (const ldapRole of ROLES) {\n          for (const aux of roles) {\n            if (aux.includes(ldapRole)) {\n              role = ldapRole;\n              break;\n            }\n          } //Eh feio. mas tem um proposito. Serve para sair do laço mais externo caso algum papel tenha sido já selecionado. \n\n\n          if (role !== 'CICC') {\n            break;\n          }\n        }\n\n        console.log(\"ROLE ESCOLHIDO\", role);\n        setUserRole(role);\n        setLDAPRoles(res.data[\"groups\"]);\n        setJWT(token);\n        setCortexToken(cortex_token);\n        setUserLogin(email);\n        setViewedWarnings(JSON.stringify([]));\n        setNearClosingWarningModalEnabled('true');\n        setPendingHomologationModalEnabled('true');\n        return true;\n      } else {\n        setMessage('Login e/ou senha inválido(s)!');\n        return false;\n      }\n    }).catch(err => {\n      console.log(err);\n      setMessage('Erro! Tente novamente mais tarde!');\n      return false;\n    });\n  };\n\n  return isGlobalLoading ? /*#__PURE__*/_jsxDEV(LoadingPage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 239,\n    columnNumber: 7\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loginContainer\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loginForm\",\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        children: [/*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralized\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: logo,\n              alt: \"cicc-logo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralized\",\n            style: {\n              fontSize: 18\n            },\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Sistema Cacto\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"warning-alert\".concat(message !== '' ? ' visible' : ' hidden'),\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(RiCloseFill, {\n            onClick: () => setMessage('')\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralize\",\n            children: /*#__PURE__*/_jsxDEV(FormGroup, {\n              style: {\n                width: \"100%\"\n              },\n              children: /*#__PURE__*/_jsxDEV(InputGroup, {\n                children: [/*#__PURE__*/_jsxDEV(InputGroupAddon, {\n                  addonType: \"prepend\",\n                  children: /*#__PURE__*/_jsxDEV(InputGroupText, {\n                    style: {\n                      display: \"inline-block\",\n                      margin: \"auto\",\n                      backgroundColor: isLoading ? '#E3E3E3' : 'white',\n                      border: userFocus && \"1px #9A9A9A\",\n                      borderStyle: userFocus && \"solid none solid solid\"\n                    },\n                    children: /*#__PURE__*/_jsxDEV(RiUser3Fill, {\n                      style: {\n                        marginRight: '0.5rem'\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 272,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 269,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 268,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Input, {\n                  placeholder: \"Usu\\xE1rio\",\n                  type: \"email\",\n                  disabled: isLoading,\n                  onFocus: onUserFocus,\n                  onBlur: onUserFocus,\n                  onChange: e => setEmail(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 275,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralize\",\n            children: /*#__PURE__*/_jsxDEV(FormGroup, {\n              style: {\n                width: \"100%\"\n              },\n              children: /*#__PURE__*/_jsxDEV(InputGroup, {\n                children: [/*#__PURE__*/_jsxDEV(InputGroupAddon, {\n                  addonType: \"prepend\",\n                  children: /*#__PURE__*/_jsxDEV(InputGroupText, {\n                    style: {\n                      display: \"inline-block\",\n                      margin: \"auto\",\n                      backgroundColor: isLoading ? '#E3E3E3' : 'white',\n                      border: passFocus && \"1px #9A9A9A\",\n                      borderStyle: passFocus && \"solid none solid solid\"\n                    },\n                    children: /*#__PURE__*/_jsxDEV(RiLockFill, {\n                      style: {\n                        marginRight: '0.5rem'\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 290,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 287,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 286,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Input, {\n                  placeholder: \"Senha\",\n                  type: \"password\",\n                  disabled: isLoading,\n                  onFocus: onPassFocus,\n                  onBlur: onPassFocus,\n                  onChange: e => setPassword(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 293,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 285,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 284,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralize\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"forgotContainer\",\n              style: {\n                textAlign: \"center\"\n              },\n              children: [\"Dificuldade de Acesso? Entre em contato diretamente com a \", ' ', /*#__PURE__*/_jsxDEV(\"a\", {\n                href: \"https://www.sefaz.pb.gov.br/contact\",\n                children: \"SEFAZ/PB\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 304,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Row, {\n          children: /*#__PURE__*/_jsxDEV(Col, {\n            className: \"centralize\",\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              disabled: isLoading,\n              color: \"primary\",\n              style: {\n                height: '2.7rem'\n              },\n              onClick: login,\n              children: isLoading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Spinner, {\n                  color: \"white\",\n                  size: \"sm\",\n                  style: {\n                    marginRight: 10\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 316,\n                  columnNumber: 23\n                }, this), \"Entrando...\"]\n              }, void 0, true) : \"Entrar\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 313,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 241,\n    columnNumber: 7\n  }, this);\n}\n\n_s(Login, \"Jxxa2EuZsoi5F8uqR0TDOLu3GzU=\", false, function () {\n  return [useHistory];\n});\n\n_c = Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["C:/Users/rodri/OneDrive/Documentos/cicc-app/front-end/src/layouts/Login.js"],"names":["React","axios","axiosRetry","getTimeoutConfig","getRetryConfig","useHistory","Row","Col","Button","Form","FormGroup","Input","InputGroup","InputGroupAddon","InputGroupText","Spinner","RiUser3Fill","RiLockFill","RiCloseFill","LoadingPage","MapsContext","DashboardContext","WarningsContext","AuditorsContext","GroupsContext","mountViews","GROUPS_ENUM","env","routes","isLoggedIn","createBaseHttpRequestBody","getUserLogin","getLDAPRoles","setUserID","setUserRegistrationID","setVisibilityGroups","setUserRole","setLDAPRoles","setJWT","setCortexToken","setUserLogin","setViewedWarnings","setNearClosingWarningModalEnabled","setPendingHomologationModalEnabled","setUserName","isComandoFiscal","setMonitoringChiefFlag","LOGIN","configureHttp","WarningsUpdateContext","Login","props","history","userFocus","setUserFocus","useState","passFocus","setPassFocus","isLoading","setLoading","isGlobalLoading","setGlobalLoading","email","setEmail","password","setPassword","message","setMessage","onUserFocus","onPassFocus","getCamerasData","useContext","getDashboardData","startSSE","setWasReloaded","startWarningsViewedSSE","getAuditorsData","fetchGroupsData","fetchGroupsName","getGroupRegistry","loginProcessFinished","setLoginProcessFinished","axiosRetryProxy","create","useEffect","push","Notification","requestPermission","login","getToken","loadUserData","roles","GRs","visibilityGroups","GERAL","localStorage","getItem","GAECO","DNIT","PRF","forEach","group","includes","httpRequestBody","post","apiAddress","then","res","data","groups","monitoramentoGroup","MONITORAMENTO","catch","err","console","log","finally","token","cortex_token","role","ROLES","ldapRole","aux","JSON","stringify","logo","fontSize","width","display","margin","backgroundColor","border","borderStyle","marginRight","e","target","value","textAlign","height"],"mappings":"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","sourcesContent":["\r\nimport React from \"react\"\r\nimport axios from 'axios';\r\nimport axiosRetry from 'axios-retry';\r\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\r\nimport { getRetryConfig } from \"axios/AxiosUtils\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {\r\n  Row,\r\n  Col,\r\n  Button,\r\n  Form,\r\n  FormGroup,\r\n  Input,\r\n  InputGroup,\r\n  InputGroupAddon,\r\n  InputGroupText,\r\n  Spinner\r\n} from 'reactstrap';\r\nimport { RiUser3Fill, RiLockFill, RiCloseFill } from 'react-icons/ri';\r\n\r\nimport LoadingPage from \"layouts/Loading\";\r\nimport { MapsContext } from \"context/MapsContext\";\r\nimport { DashboardContext } from \"context/DashboardContext\";\r\nimport { WarningsContext } from \"context/WarningsContext\";\r\nimport { AuditorsContext } from \"context/AuditorsContext\";\r\nimport { GroupsContext } from \"context/GroupsContext\";\r\nimport { mountViews } from \"views/ViewsCreator\";\r\nimport GROUPS_ENUM from 'common/enumerators/GroupsEnum';\r\nimport logo from \"logo.svg\";\r\nimport env from \"common/enviroment\";\r\nimport routes from \"routes.js\";\r\nimport { isLoggedIn } from \"common/SessionUtils\";\r\nimport { createBaseHttpRequestBody } from \"axios/AxiosUtils\";\r\nimport { getUserLogin } from \"common/SessionUtils\";\r\nimport { getLDAPRoles } from \"common/SessionUtils\";\r\nimport { setUserID } from \"common/SessionUtils\";\r\nimport { setUserRegistrationID } from \"common/SessionUtils\";\r\nimport { setVisibilityGroups } from \"common/SessionUtils\";\r\nimport { setUserRole } from \"common/SessionUtils\";\r\nimport { setLDAPRoles } from \"common/SessionUtils\";\r\nimport { setJWT } from \"common/SessionUtils\";\r\nimport { setCortexToken } from \"common/SessionUtils\";\r\nimport { setUserLogin } from \"common/SessionUtils\";\r\nimport { setViewedWarnings } from \"common/SessionUtils\";\r\nimport { setNearClosingWarningModalEnabled, setPendingHomologationModalEnabled } from \"common/SessionUtils\";\r\nimport { setUserName } from \"common/SessionUtils\";\r\nimport { isComandoFiscal } from \"common/SessionUtils\";\r\nimport { setMonitoringChiefFlag } from \"common/SessionUtils\";\r\nimport { LOGIN } from \"axios/AxiosUtils\";\r\nimport { configureHttp } from \"axios/http/configure-http\";\r\nimport { WarningsUpdateContext } from \"context/WarningsUpdateContext\";\r\n\r\n\r\n\r\nexport default function Login(props) {\r\n  const history = useHistory()\r\n\r\n  // Contorno dos inputs\r\n  const [userFocus, setUserFocus] = React.useState(false)\r\n  const [passFocus, setPassFocus] = React.useState(false)\r\n  const [isLoading, setLoading] = React.useState(false)\r\n  const [isGlobalLoading, setGlobalLoading] = React.useState(false)\r\n  const [email, setEmail] = React.useState('')\r\n  const [password, setPassword] = React.useState('')\r\n  const [message, setMessage] = React.useState('')\r\n\r\n  const onUserFocus = () => setUserFocus(!userFocus)\r\n  const onPassFocus = () => setPassFocus(!passFocus)\r\n\r\n  // Contextos para extrair dados das telas\r\n  const { getCamerasData } = React.useContext(MapsContext)\r\n  const { getDashboardData } = React.useContext(DashboardContext)\r\n  const { startSSE, setWasReloaded } = React.useContext(WarningsContext)\r\n  const { startWarningsViewedSSE } = React.useContext(WarningsUpdateContext)\r\n  const { getAuditorsData } = React.useContext(AuditorsContext)\r\n  const { fetchGroupsData, fetchGroupsName, getGroupRegistry } = React.useContext(GroupsContext)\r\n  const [loginProcessFinished, setLoginProcessFinished] = React.useState(false);\r\n\r\n  const axiosRetryProxy = axios.create(getTimeoutConfig(LOGIN))\r\n  axiosRetry(axiosRetryProxy, getRetryConfig())\r\n\r\n  React.useEffect(() => {\r\n    if (isLoggedIn()) {\r\n\r\n      setWasReloaded(false)\r\n\r\n      mountViews(routes)\r\n      setGlobalLoading(false)\r\n\r\n      if (isComandoFiscal()) {\r\n        history.push('/admin/notifications') // Trocar de tela\r\n      } else {\r\n        history.push('/admin/tables') // Trocar de tela\r\n      }\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [loginProcessFinished])\r\n\r\n  Notification.requestPermission()\r\n\r\n  const login = async () => {\r\n    configureHttp()\r\n    setLoading(true)\r\n    if (await getToken()) {\r\n      setGlobalLoading(true)\r\n      await fetchGroupsData()\r\n      if (await loadUserData()) {\r\n        await fetchGroupsName()\r\n        await getAuditorsData(true)\r\n        startSSE() \r\n        startWarningsViewedSSE()\r\n        setLoginProcessFinished(true)\r\n        \r\n      }\r\n    }\r\n    setLoading(false)\r\n  }\r\n\r\n  const loadUserData = async () => {\r\n    let roles = getLDAPRoles()\r\n\r\n    //Construir uma lista com grupos que o usuário logado tem visibilidade para ver. \r\n    //É um processo em passos. \r\n    //Primeiro, são carregados os grupos institucionais. Estes grupos virão do ldap. \r\n    const GRs = ['GR1', 'GR2', 'GR3', 'GR4', 'GR5', 'COE', 'ATIF', 'GECOF', 'GOFMT']\r\n    let visibilityGroups = [GROUPS_ENUM.GERAL] //Qualquer usuário logado ao sistema vai ter acesso ao grupo geral\r\n    if (localStorage.getItem('role') === \"GAECO\") {\r\n      visibilityGroups = [GROUPS_ENUM.GAECO]\r\n    } else if (localStorage.getItem('role') === \"DNIT\") {\r\n      visibilityGroups = [GROUPS_ENUM.DNIT]\r\n    } else if (localStorage.getItem('role') === \"PRF\") {\r\n      visibilityGroups = [GROUPS_ENUM.PRF]\r\n    }\r\n\r\n    GRs.forEach(group => {\r\n      if (roles.includes(group)) {\r\n        visibilityGroups.push(GROUPS_ENUM[group]);\r\n      }\r\n    });\r\n\r\n    const httpRequestBody = createBaseHttpRequestBody()\r\n    httpRequestBody['user_login'] = getUserLogin()\r\n\r\n    return await axiosRetryProxy.post(`${env.apiAddress}/auditor/read`, httpRequestBody).then(res => {\r\n\r\n      let data = res.data[0]\r\n      if (data['user_id']) {\r\n\r\n        setUserID(data['user_id'])\r\n        setUserRegistrationID(data['user_registration_id'])\r\n        setUserName(data['user_name'])\r\n\r\n        let groups = data['usuario_grupo']\r\n\r\n        //Segunda parte dos grupos, virá tabela usuario_grupo\r\n        for (const group of groups) {\r\n          visibilityGroups.push(group['group_id'])\r\n        }\r\n\r\n        //Marcar se o usuário é chefe do grupo de monitoramento\r\n        let monitoramentoGroup = getGroupRegistry(GROUPS_ENUM.MONITORAMENTO)\r\n\r\n        if (monitoramentoGroup && monitoramentoGroup['group_owner_data'][0] && monitoramentoGroup['group_owner_data'][0]['user_login'] === getUserLogin()) {\r\n          setMonitoringChiefFlag(true)\r\n        }\r\n\r\n      }\r\n      return true\r\n    }).catch(err => {\r\n      console.log(err)\r\n      return true\r\n    }).finally(() => {\r\n      setVisibilityGroups(visibilityGroups)\r\n    })\r\n  }\r\n\r\n  const getToken = () => {\r\n    const httpRequestBody = {\r\n      'email': email,\r\n      'password': password\r\n    }\r\n\r\n    return axiosRetryProxy.post(`${env.apiAddress}/login`, httpRequestBody)\r\n      .then(res => {\r\n\r\n        if (res.data[\"code\"] === 200) {\r\n          const token = res.data[\"jwt_token\"]\r\n          const cortex_token = res.data[\"cortex_token\"]\r\n\r\n          let roles = res.data[\"groups\"]\r\n          console.log(\"ROLES\", roles, res.data)\r\n\r\n          let role = 'CICC'\r\n          const ROLES = ['ADMIN', 'SUBGERENTE', 'GAECO', 'PRF', 'DNIT', 'COE', 'GOFMT', 'GECOF', 'GOAC', 'ATIF', 'COMANDO', 'MONITORAMENTO', 'COMANDOFISCAL', 'OPERACIONAL', 'CICC']\r\n\r\n          for (const ldapRole of ROLES) {\r\n            for (const aux of roles) {\r\n              if (aux.includes(ldapRole)) {\r\n                role = ldapRole;\r\n                break;\r\n              }\r\n            }\r\n            //Eh feio. mas tem um proposito. Serve para sair do laço mais externo caso algum papel tenha sido já selecionado. \r\n            if (role !== 'CICC') {\r\n              break\r\n            }\r\n          }\r\n\r\n          console.log(\"ROLE ESCOLHIDO\", role)\r\n\r\n          setUserRole(role)\r\n          setLDAPRoles(res.data[\"groups\"])\r\n          setJWT(token)\r\n          setCortexToken(cortex_token)\r\n          setUserLogin(email)\r\n          setViewedWarnings(JSON.stringify([]))\r\n          setNearClosingWarningModalEnabled('true')\r\n          setPendingHomologationModalEnabled('true')\r\n\r\n\r\n          return true\r\n        }\r\n        else {\r\n          setMessage('Login e/ou senha inválido(s)!')\r\n          return false\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.log(err)\r\n        setMessage('Erro! Tente novamente mais tarde!')\r\n        return false\r\n      })\r\n  }\r\n\r\n  return (\r\n    isGlobalLoading ?\r\n      <LoadingPage/>\r\n      :\r\n      <div className=\"loginContainer\">\r\n        <div className=\"loginForm\">\r\n\r\n          <Form>\r\n            <Row>\r\n              <Col className=\"centralized\">\r\n                <img src={logo} alt=\"cicc-logo\" />\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row>\r\n              <Col className=\"centralized\" style={{ fontSize: 18 }}>\r\n                <span>Sistema Cacto</span>\r\n              </Col>\r\n            </Row>\r\n\r\n            <div className={`warning-alert${message !== '' ? ' visible' : ' hidden'}`}>\r\n              <div>\r\n                {message}\r\n              </div>\r\n              <RiCloseFill onClick={() => setMessage('')} />\r\n            </div>\r\n\r\n            <Row>\r\n              <Col className=\"centralize\">\r\n                <FormGroup style={{ width: \"100%\" }}>\r\n                  <InputGroup >\r\n                    <InputGroupAddon addonType=\"prepend\">\r\n                      <InputGroupText\r\n                        style={{ display: \"inline-block\", margin: \"auto\", backgroundColor: isLoading ? '#E3E3E3' : 'white', border: userFocus && \"1px #9A9A9A\", borderStyle: userFocus && \"solid none solid solid\" }}\r\n                      >\r\n                        <RiUser3Fill style={{ marginRight: '0.5rem' }} />\r\n                      </InputGroupText>\r\n                    </InputGroupAddon>\r\n                    <Input placeholder=\"Usuário\" type=\"email\" disabled={isLoading} onFocus={onUserFocus} onBlur={onUserFocus} onChange={e => setEmail(e.target.value)} />\r\n                  </InputGroup>\r\n                </FormGroup>\r\n\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row >\r\n              <Col className=\"centralize\">\r\n                <FormGroup style={{ width: \"100%\" }}>\r\n                  <InputGroup >\r\n                    <InputGroupAddon addonType=\"prepend\">\r\n                      <InputGroupText\r\n                        style={{ display: \"inline-block\", margin: \"auto\", backgroundColor: isLoading ? '#E3E3E3' : 'white', border: passFocus && \"1px #9A9A9A\", borderStyle: passFocus && \"solid none solid solid\" }}\r\n                      >\r\n                        <RiLockFill style={{ marginRight: '0.5rem' }} />\r\n                      </InputGroupText>\r\n                    </InputGroupAddon>\r\n                    <Input placeholder=\"Senha\" type=\"password\" disabled={isLoading} onFocus={onPassFocus} onBlur={onPassFocus} onChange={e => setPassword(e.target.value)} />\r\n                  </InputGroup>\r\n                </FormGroup>\r\n\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row>\r\n              <Col className=\"centralize\">\r\n                <div className=\"forgotContainer\" style={{ textAlign: \"center\" }}>\r\n                  Dificuldade de Acesso? Entre em contato diretamente com a {' '}\r\n                  <a href=\"https://www.sefaz.pb.gov.br/contact\">\r\n                    SEFAZ/PB\r\n                  </a>\r\n                </div>\r\n              </Col>\r\n            </Row>\r\n\r\n            <Row >\r\n              <Col className=\"centralize\">\r\n                <Button disabled={isLoading} color=\"primary\" style={{ height: '2.7rem' }} onClick={login}>\r\n                  {isLoading ?\r\n                    <>\r\n                      <Spinner color=\"white\" size=\"sm\" style={{ marginRight: 10 }} />\r\n                      Entrando...\r\n                    </> : \"Entrar\"}\r\n                </Button>\r\n              </Col>\r\n            </Row>\r\n          </Form>\r\n        </div>\r\n      </div>\r\n  );\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}