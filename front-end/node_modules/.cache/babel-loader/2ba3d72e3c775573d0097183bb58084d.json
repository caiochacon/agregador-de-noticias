{"ast":null,"code":"var parse = require('url').parse;\n\nvar events = require('events');\n\nvar https = require('https');\n\nvar http = require('http');\n\nvar util = require('util');\n\nvar httpsOptions = ['pfx', 'key', 'passphrase', 'cert', 'ca', 'ciphers', 'rejectUnauthorized', 'secureProtocol', 'servername', 'checkServerIdentity'];\nvar bom = [239, 187, 191];\nvar colon = 58;\nvar space = 32;\nvar lineFeed = 10;\nvar carriageReturn = 13; // Beyond 256KB we could not observe any gain in performance\n\nvar maxBufferAheadAllocation = 1024 * 256; // Headers matching the pattern should be removed when redirecting to different origin\n\nvar reUnsafeHeader = /^(cookie|authorization)$/i;\n\nfunction hasBom(buf) {\n  return bom.every(function (charCode, index) {\n    return buf[index] === charCode;\n  });\n}\n/**\n * Creates a new EventSource object\n *\n * @param {String} url the URL to which to connect\n * @param {Object} [eventSourceInitDict] extra init params. See README for details.\n * @api public\n **/\n\n\nfunction EventSource(url, eventSourceInitDict) {\n  var readyState = EventSource.CONNECTING;\n  var headers = eventSourceInitDict && eventSourceInitDict.headers;\n  var hasNewOrigin = false;\n  Object.defineProperty(this, 'readyState', {\n    get: function () {\n      return readyState;\n    }\n  });\n  Object.defineProperty(this, 'url', {\n    get: function () {\n      return url;\n    }\n  });\n  var self = this;\n  self.reconnectInterval = 1000;\n  self.connectionInProgress = false;\n\n  function onConnectionClosed(message) {\n    if (readyState === EventSource.CLOSED) return;\n    readyState = EventSource.CONNECTING;\n\n    _emit('error', new Event('error', {\n      message: message\n    })); // The url may have been changed by a temporary redirect. If that's the case,\n    // revert it now, and flag that we are no longer pointing to a new origin\n\n\n    if (reconnectUrl) {\n      url = reconnectUrl;\n      reconnectUrl = null;\n      hasNewOrigin = false;\n    }\n\n    setTimeout(function () {\n      if (readyState !== EventSource.CONNECTING || self.connectionInProgress) {\n        return;\n      }\n\n      self.connectionInProgress = true;\n      connect();\n    }, self.reconnectInterval);\n  }\n\n  var req;\n  var lastEventId = '';\n\n  if (headers && headers['Last-Event-ID']) {\n    lastEventId = headers['Last-Event-ID'];\n    delete headers['Last-Event-ID'];\n  }\n\n  var discardTrailingNewline = false;\n  var data = '';\n  var eventName = '';\n  var reconnectUrl = null;\n\n  function connect() {\n    var options = parse(url);\n    var isSecure = options.protocol === 'https:';\n    options.headers = {\n      'Cache-Control': 'no-cache',\n      'Accept': 'text/event-stream'\n    };\n    if (lastEventId) options.headers['Last-Event-ID'] = lastEventId;\n\n    if (headers) {\n      var reqHeaders = hasNewOrigin ? removeUnsafeHeaders(headers) : headers;\n\n      for (var i in reqHeaders) {\n        var header = reqHeaders[i];\n\n        if (header) {\n          options.headers[i] = header;\n        }\n      }\n    } // Legacy: this should be specified as `eventSourceInitDict.https.rejectUnauthorized`,\n    // but for now exists as a backwards-compatibility layer\n\n\n    options.rejectUnauthorized = !(eventSourceInitDict && !eventSourceInitDict.rejectUnauthorized);\n\n    if (eventSourceInitDict && eventSourceInitDict.createConnection !== undefined) {\n      options.createConnection = eventSourceInitDict.createConnection;\n    } // If specify http proxy, make the request to sent to the proxy server,\n    // and include the original url in path and Host headers\n\n\n    var useProxy = eventSourceInitDict && eventSourceInitDict.proxy;\n\n    if (useProxy) {\n      var proxy = parse(eventSourceInitDict.proxy);\n      isSecure = proxy.protocol === 'https:';\n      options.protocol = isSecure ? 'https:' : 'http:';\n      options.path = url;\n      options.headers.Host = options.host;\n      options.hostname = proxy.hostname;\n      options.host = proxy.host;\n      options.port = proxy.port;\n    } // If https options are specified, merge them into the request options\n\n\n    if (eventSourceInitDict && eventSourceInitDict.https) {\n      for (var optName in eventSourceInitDict.https) {\n        if (httpsOptions.indexOf(optName) === -1) {\n          continue;\n        }\n\n        var option = eventSourceInitDict.https[optName];\n\n        if (option !== undefined) {\n          options[optName] = option;\n        }\n      }\n    } // Pass this on to the XHR\n\n\n    if (eventSourceInitDict && eventSourceInitDict.withCredentials !== undefined) {\n      options.withCredentials = eventSourceInitDict.withCredentials;\n    }\n\n    req = (isSecure ? https : http).request(options, function (res) {\n      self.connectionInProgress = false; // Handle HTTP errors\n\n      if (res.statusCode === 500 || res.statusCode === 502 || res.statusCode === 503 || res.statusCode === 504) {\n        _emit('error', new Event('error', {\n          status: res.statusCode,\n          message: res.statusMessage\n        }));\n\n        onConnectionClosed();\n        return;\n      } // Handle HTTP redirects\n\n\n      if (res.statusCode === 301 || res.statusCode === 302 || res.statusCode === 307) {\n        var location = res.headers.location;\n\n        if (!location) {\n          // Server sent redirect response without Location header.\n          _emit('error', new Event('error', {\n            status: res.statusCode,\n            message: res.statusMessage\n          }));\n\n          return;\n        }\n\n        var prevOrigin = new URL(url).origin;\n        var nextOrigin = new URL(location).origin;\n        hasNewOrigin = prevOrigin !== nextOrigin;\n        if (res.statusCode === 307) reconnectUrl = url;\n        url = location;\n        process.nextTick(connect);\n        return;\n      }\n\n      if (res.statusCode !== 200) {\n        _emit('error', new Event('error', {\n          status: res.statusCode,\n          message: res.statusMessage\n        }));\n\n        return self.close();\n      }\n\n      readyState = EventSource.OPEN;\n      res.on('close', function () {\n        res.removeAllListeners('close');\n        res.removeAllListeners('end');\n        onConnectionClosed();\n      });\n      res.on('end', function () {\n        res.removeAllListeners('close');\n        res.removeAllListeners('end');\n        onConnectionClosed();\n      });\n\n      _emit('open', new Event('open')); // text/event-stream parser adapted from webkit's\n      // Source/WebCore/page/EventSource.cpp\n\n\n      var buf;\n      var newBuffer;\n      var startingPos = 0;\n      var startingFieldLength = -1;\n      var newBufferSize = 0;\n      var bytesUsed = 0;\n      res.on('data', function (chunk) {\n        if (!buf) {\n          buf = chunk;\n\n          if (hasBom(buf)) {\n            buf = buf.slice(bom.length);\n          }\n\n          bytesUsed = buf.length;\n        } else {\n          if (chunk.length > buf.length - bytesUsed) {\n            newBufferSize = buf.length * 2 + chunk.length;\n\n            if (newBufferSize > maxBufferAheadAllocation) {\n              newBufferSize = buf.length + chunk.length + maxBufferAheadAllocation;\n            }\n\n            newBuffer = Buffer.alloc(newBufferSize);\n            buf.copy(newBuffer, 0, 0, bytesUsed);\n            buf = newBuffer;\n          }\n\n          chunk.copy(buf, bytesUsed);\n          bytesUsed += chunk.length;\n        }\n\n        var pos = 0;\n        var length = bytesUsed;\n\n        while (pos < length) {\n          if (discardTrailingNewline) {\n            if (buf[pos] === lineFeed) {\n              ++pos;\n            }\n\n            discardTrailingNewline = false;\n          }\n\n          var lineLength = -1;\n          var fieldLength = startingFieldLength;\n          var c;\n\n          for (var i = startingPos; lineLength < 0 && i < length; ++i) {\n            c = buf[i];\n\n            if (c === colon) {\n              if (fieldLength < 0) {\n                fieldLength = i - pos;\n              }\n            } else if (c === carriageReturn) {\n              discardTrailingNewline = true;\n              lineLength = i - pos;\n            } else if (c === lineFeed) {\n              lineLength = i - pos;\n            }\n          }\n\n          if (lineLength < 0) {\n            startingPos = length - pos;\n            startingFieldLength = fieldLength;\n            break;\n          } else {\n            startingPos = 0;\n            startingFieldLength = -1;\n          }\n\n          parseEventStreamLine(buf, pos, fieldLength, lineLength);\n          pos += lineLength + 1;\n        }\n\n        if (pos === length) {\n          buf = void 0;\n          bytesUsed = 0;\n        } else if (pos > 0) {\n          buf = buf.slice(pos, bytesUsed);\n          bytesUsed = buf.length;\n        }\n      });\n    });\n    req.on('error', function (err) {\n      self.connectionInProgress = false;\n      onConnectionClosed(err.message);\n    });\n    if (req.setNoDelay) req.setNoDelay(true);\n    req.end();\n  }\n\n  connect();\n\n  function _emit() {\n    if (self.listeners(arguments[0]).length > 0) {\n      self.emit.apply(self, arguments);\n    }\n  }\n\n  this._close = function () {\n    if (readyState === EventSource.CLOSED) return;\n    readyState = EventSource.CLOSED;\n    if (req.abort) req.abort();\n    if (req.xhr && req.xhr.abort) req.xhr.abort();\n  };\n\n  function parseEventStreamLine(buf, pos, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        var type = eventName || 'message';\n\n        _emit(type, new MessageEvent(type, {\n          data: data.slice(0, -1),\n          // remove trailing newline\n          lastEventId: lastEventId,\n          origin: new URL(url).origin\n        }));\n\n        data = '';\n      }\n\n      eventName = void 0;\n    } else if (fieldLength > 0) {\n      var noValue = fieldLength < 0;\n      var step = 0;\n      var field = buf.slice(pos, pos + (noValue ? lineLength : fieldLength)).toString();\n\n      if (noValue) {\n        step = lineLength;\n      } else if (buf[pos + fieldLength + 1] !== space) {\n        step = fieldLength + 1;\n      } else {\n        step = fieldLength + 2;\n      }\n\n      pos += step;\n      var valueLength = lineLength - step;\n      var value = buf.slice(pos, pos + valueLength).toString();\n\n      if (field === 'data') {\n        data += value + '\\n';\n      } else if (field === 'event') {\n        eventName = value;\n      } else if (field === 'id') {\n        lastEventId = value;\n      } else if (field === 'retry') {\n        var retry = parseInt(value, 10);\n\n        if (!Number.isNaN(retry)) {\n          self.reconnectInterval = retry;\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = EventSource;\nutil.inherits(EventSource, events.EventEmitter);\nEventSource.prototype.constructor = EventSource; // make stacktraces readable\n\n['open', 'error', 'message'].forEach(function (method) {\n  Object.defineProperty(EventSource.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    get: function get() {\n      var listener = this.listeners(method)[0];\n      return listener ? listener._listener ? listener._listener : listener : undefined;\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    set: function set(listener) {\n      this.removeAllListeners(method);\n      this.addEventListener(method, listener);\n    }\n  });\n});\n/**\n * Ready states\n */\n\nObject.defineProperty(EventSource, 'CONNECTING', {\n  enumerable: true,\n  value: 0\n});\nObject.defineProperty(EventSource, 'OPEN', {\n  enumerable: true,\n  value: 1\n});\nObject.defineProperty(EventSource, 'CLOSED', {\n  enumerable: true,\n  value: 2\n});\nEventSource.prototype.CONNECTING = 0;\nEventSource.prototype.OPEN = 1;\nEventSource.prototype.CLOSED = 2;\n/**\n * Closes the connection, if one is made, and sets the readyState attribute to 2 (closed)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventSource/close\n * @api public\n */\n\nEventSource.prototype.close = function () {\n  this._close();\n};\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @param {String} type A string representing the event type to listen out for\n * @param {Function} listener callback\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n\n\nEventSource.prototype.addEventListener = function addEventListener(type, listener) {\n  if (typeof listener === 'function') {\n    // store a reference so we can return the original function again\n    listener._listener = listener;\n    this.on(type, listener);\n  }\n};\n/**\n * Emulates the W3C Browser based WebSocket interface using dispatchEvent.\n *\n * @param {Event} event An event to be dispatched\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n * @api public\n */\n\n\nEventSource.prototype.dispatchEvent = function dispatchEvent(event) {\n  if (!event.type) {\n    throw new Error('UNSPECIFIED_EVENT_TYPE_ERR');\n  } // if event is instance of an CustomEvent (or has 'details' property),\n  // send the detail object as the payload for the event\n\n\n  this.emit(event.type, event.detail);\n};\n/**\n * Emulates the W3C Browser based WebSocket interface using removeEventListener.\n *\n * @param {String} type A string representing the event type to remove\n * @param {Function} listener callback\n * @see https://developer.mozilla.org/en/DOM/element.removeEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\n\n\nEventSource.prototype.removeEventListener = function removeEventListener(type, listener) {\n  if (typeof listener === 'function') {\n    listener._listener = undefined;\n    this.removeListener(type, listener);\n  }\n};\n/**\n * W3C Event\n *\n * @see http://www.w3.org/TR/DOM-Level-3-Events/#interface-Event\n * @api private\n */\n\n\nfunction Event(type, optionalProperties) {\n  Object.defineProperty(this, 'type', {\n    writable: false,\n    value: type,\n    enumerable: true\n  });\n\n  if (optionalProperties) {\n    for (var f in optionalProperties) {\n      if (optionalProperties.hasOwnProperty(f)) {\n        Object.defineProperty(this, f, {\n          writable: false,\n          value: optionalProperties[f],\n          enumerable: true\n        });\n      }\n    }\n  }\n}\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/webmessaging/#event-definitions\n * @api private\n */\n\n\nfunction MessageEvent(type, eventInitDict) {\n  Object.defineProperty(this, 'type', {\n    writable: false,\n    value: type,\n    enumerable: true\n  });\n\n  for (var f in eventInitDict) {\n    if (eventInitDict.hasOwnProperty(f)) {\n      Object.defineProperty(this, f, {\n        writable: false,\n        value: eventInitDict[f],\n        enumerable: true\n      });\n    }\n  }\n}\n/**\n * Returns a new object of headers that does not include any authorization and cookie headers\n *\n * @param {Object} headers An object of headers ({[headerName]: headerValue})\n * @return {Object} a new object of headers\n * @api private\n */\n\n\nfunction removeUnsafeHeaders(headers) {\n  var safe = {};\n\n  for (var key in headers) {\n    if (reUnsafeHeader.test(key)) {\n      continue;\n    }\n\n    safe[key] = headers[key];\n  }\n\n  return safe;\n}","map":{"version":3,"sources":["C:/aria/cicc-app/front-end/node_modules/eventsource/lib/eventsource.js"],"names":["parse","require","events","https","http","util","httpsOptions","bom","colon","space","lineFeed","carriageReturn","maxBufferAheadAllocation","reUnsafeHeader","hasBom","buf","every","charCode","index","EventSource","url","eventSourceInitDict","readyState","CONNECTING","headers","hasNewOrigin","Object","defineProperty","get","self","reconnectInterval","connectionInProgress","onConnectionClosed","message","CLOSED","_emit","Event","reconnectUrl","setTimeout","connect","req","lastEventId","discardTrailingNewline","data","eventName","options","isSecure","protocol","reqHeaders","removeUnsafeHeaders","i","header","rejectUnauthorized","createConnection","undefined","useProxy","proxy","path","Host","host","hostname","port","optName","indexOf","option","withCredentials","request","res","statusCode","status","statusMessage","location","prevOrigin","URL","origin","nextOrigin","process","nextTick","close","OPEN","on","removeAllListeners","newBuffer","startingPos","startingFieldLength","newBufferSize","bytesUsed","chunk","slice","length","Buffer","alloc","copy","pos","lineLength","fieldLength","c","parseEventStreamLine","err","setNoDelay","end","listeners","arguments","emit","apply","_close","abort","xhr","type","MessageEvent","noValue","step","field","toString","valueLength","value","retry","parseInt","Number","isNaN","module","exports","inherits","EventEmitter","prototype","constructor","forEach","method","listener","_listener","set","addEventListener","enumerable","dispatchEvent","event","Error","detail","removeEventListener","removeListener","optionalProperties","writable","f","hasOwnProperty","eventInitDict","safe","key","test"],"mappings":"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","sourcesContent":["var parse = require('url').parse\nvar events = require('events')\nvar https = require('https')\nvar http = require('http')\nvar util = require('util')\n\nvar httpsOptions = [\n  'pfx', 'key', 'passphrase', 'cert', 'ca', 'ciphers',\n  'rejectUnauthorized', 'secureProtocol', 'servername', 'checkServerIdentity'\n]\n\nvar bom = [239, 187, 191]\nvar colon = 58\nvar space = 32\nvar lineFeed = 10\nvar carriageReturn = 13\n// Beyond 256KB we could not observe any gain in performance\nvar maxBufferAheadAllocation = 1024 * 256\n// Headers matching the pattern should be removed when redirecting to different origin\nvar reUnsafeHeader = /^(cookie|authorization)$/i\n\nfunction hasBom (buf) {\n  return bom.every(function (charCode, index) {\n    return buf[index] === charCode\n  })\n}\n\n/**\n * Creates a new EventSource object\n *\n * @param {String} url the URL to which to connect\n * @param {Object} [eventSourceInitDict] extra init params. See README for details.\n * @api public\n **/\nfunction EventSource (url, eventSourceInitDict) {\n  var readyState = EventSource.CONNECTING\n  var headers = eventSourceInitDict && eventSourceInitDict.headers\n  var hasNewOrigin = false\n  Object.defineProperty(this, 'readyState', {\n    get: function () {\n      return readyState\n    }\n  })\n\n  Object.defineProperty(this, 'url', {\n    get: function () {\n      return url\n    }\n  })\n\n  var self = this\n  self.reconnectInterval = 1000\n  self.connectionInProgress = false\n\n  function onConnectionClosed (message) {\n    if (readyState === EventSource.CLOSED) return\n    readyState = EventSource.CONNECTING\n    _emit('error', new Event('error', {message: message}))\n\n    // The url may have been changed by a temporary redirect. If that's the case,\n    // revert it now, and flag that we are no longer pointing to a new origin\n    if (reconnectUrl) {\n      url = reconnectUrl\n      reconnectUrl = null\n      hasNewOrigin = false\n    }\n    setTimeout(function () {\n      if (readyState !== EventSource.CONNECTING || self.connectionInProgress) {\n        return\n      }\n      self.connectionInProgress = true\n      connect()\n    }, self.reconnectInterval)\n  }\n\n  var req\n  var lastEventId = ''\n  if (headers && headers['Last-Event-ID']) {\n    lastEventId = headers['Last-Event-ID']\n    delete headers['Last-Event-ID']\n  }\n\n  var discardTrailingNewline = false\n  var data = ''\n  var eventName = ''\n\n  var reconnectUrl = null\n\n  function connect () {\n    var options = parse(url)\n    var isSecure = options.protocol === 'https:'\n    options.headers = { 'Cache-Control': 'no-cache', 'Accept': 'text/event-stream' }\n    if (lastEventId) options.headers['Last-Event-ID'] = lastEventId\n    if (headers) {\n      var reqHeaders = hasNewOrigin ? removeUnsafeHeaders(headers) : headers\n      for (var i in reqHeaders) {\n        var header = reqHeaders[i]\n        if (header) {\n          options.headers[i] = header\n        }\n      }\n    }\n\n    // Legacy: this should be specified as `eventSourceInitDict.https.rejectUnauthorized`,\n    // but for now exists as a backwards-compatibility layer\n    options.rejectUnauthorized = !(eventSourceInitDict && !eventSourceInitDict.rejectUnauthorized)\n\n    if (eventSourceInitDict && eventSourceInitDict.createConnection !== undefined) {\n      options.createConnection = eventSourceInitDict.createConnection\n    }\n\n    // If specify http proxy, make the request to sent to the proxy server,\n    // and include the original url in path and Host headers\n    var useProxy = eventSourceInitDict && eventSourceInitDict.proxy\n    if (useProxy) {\n      var proxy = parse(eventSourceInitDict.proxy)\n      isSecure = proxy.protocol === 'https:'\n\n      options.protocol = isSecure ? 'https:' : 'http:'\n      options.path = url\n      options.headers.Host = options.host\n      options.hostname = proxy.hostname\n      options.host = proxy.host\n      options.port = proxy.port\n    }\n\n    // If https options are specified, merge them into the request options\n    if (eventSourceInitDict && eventSourceInitDict.https) {\n      for (var optName in eventSourceInitDict.https) {\n        if (httpsOptions.indexOf(optName) === -1) {\n          continue\n        }\n\n        var option = eventSourceInitDict.https[optName]\n        if (option !== undefined) {\n          options[optName] = option\n        }\n      }\n    }\n\n    // Pass this on to the XHR\n    if (eventSourceInitDict && eventSourceInitDict.withCredentials !== undefined) {\n      options.withCredentials = eventSourceInitDict.withCredentials\n    }\n\n    req = (isSecure ? https : http).request(options, function (res) {\n      self.connectionInProgress = false\n      // Handle HTTP errors\n      if (res.statusCode === 500 || res.statusCode === 502 || res.statusCode === 503 || res.statusCode === 504) {\n        _emit('error', new Event('error', {status: res.statusCode, message: res.statusMessage}))\n        onConnectionClosed()\n        return\n      }\n\n      // Handle HTTP redirects\n      if (res.statusCode === 301 || res.statusCode === 302 || res.statusCode === 307) {\n        var location = res.headers.location\n        if (!location) {\n          // Server sent redirect response without Location header.\n          _emit('error', new Event('error', {status: res.statusCode, message: res.statusMessage}))\n          return\n        }\n        var prevOrigin = new URL(url).origin\n        var nextOrigin = new URL(location).origin\n        hasNewOrigin = prevOrigin !== nextOrigin\n        if (res.statusCode === 307) reconnectUrl = url\n        url = location\n        process.nextTick(connect)\n        return\n      }\n\n      if (res.statusCode !== 200) {\n        _emit('error', new Event('error', {status: res.statusCode, message: res.statusMessage}))\n        return self.close()\n      }\n\n      readyState = EventSource.OPEN\n      res.on('close', function () {\n        res.removeAllListeners('close')\n        res.removeAllListeners('end')\n        onConnectionClosed()\n      })\n\n      res.on('end', function () {\n        res.removeAllListeners('close')\n        res.removeAllListeners('end')\n        onConnectionClosed()\n      })\n      _emit('open', new Event('open'))\n\n      // text/event-stream parser adapted from webkit's\n      // Source/WebCore/page/EventSource.cpp\n      var buf\n      var newBuffer\n      var startingPos = 0\n      var startingFieldLength = -1\n      var newBufferSize = 0\n      var bytesUsed = 0\n\n      res.on('data', function (chunk) {\n        if (!buf) {\n          buf = chunk\n          if (hasBom(buf)) {\n            buf = buf.slice(bom.length)\n          }\n          bytesUsed = buf.length\n        } else {\n          if (chunk.length > buf.length - bytesUsed) {\n            newBufferSize = (buf.length * 2) + chunk.length\n            if (newBufferSize > maxBufferAheadAllocation) {\n              newBufferSize = buf.length + chunk.length + maxBufferAheadAllocation\n            }\n            newBuffer = Buffer.alloc(newBufferSize)\n            buf.copy(newBuffer, 0, 0, bytesUsed)\n            buf = newBuffer\n          }\n          chunk.copy(buf, bytesUsed)\n          bytesUsed += chunk.length\n        }\n\n        var pos = 0\n        var length = bytesUsed\n\n        while (pos < length) {\n          if (discardTrailingNewline) {\n            if (buf[pos] === lineFeed) {\n              ++pos\n            }\n            discardTrailingNewline = false\n          }\n\n          var lineLength = -1\n          var fieldLength = startingFieldLength\n          var c\n\n          for (var i = startingPos; lineLength < 0 && i < length; ++i) {\n            c = buf[i]\n            if (c === colon) {\n              if (fieldLength < 0) {\n                fieldLength = i - pos\n              }\n            } else if (c === carriageReturn) {\n              discardTrailingNewline = true\n              lineLength = i - pos\n            } else if (c === lineFeed) {\n              lineLength = i - pos\n            }\n          }\n\n          if (lineLength < 0) {\n            startingPos = length - pos\n            startingFieldLength = fieldLength\n            break\n          } else {\n            startingPos = 0\n            startingFieldLength = -1\n          }\n\n          parseEventStreamLine(buf, pos, fieldLength, lineLength)\n\n          pos += lineLength + 1\n        }\n\n        if (pos === length) {\n          buf = void 0\n          bytesUsed = 0\n        } else if (pos > 0) {\n          buf = buf.slice(pos, bytesUsed)\n          bytesUsed = buf.length\n        }\n      })\n    })\n\n    req.on('error', function (err) {\n      self.connectionInProgress = false\n      onConnectionClosed(err.message)\n    })\n\n    if (req.setNoDelay) req.setNoDelay(true)\n    req.end()\n  }\n\n  connect()\n\n  function _emit () {\n    if (self.listeners(arguments[0]).length > 0) {\n      self.emit.apply(self, arguments)\n    }\n  }\n\n  this._close = function () {\n    if (readyState === EventSource.CLOSED) return\n    readyState = EventSource.CLOSED\n    if (req.abort) req.abort()\n    if (req.xhr && req.xhr.abort) req.xhr.abort()\n  }\n\n  function parseEventStreamLine (buf, pos, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        var type = eventName || 'message'\n        _emit(type, new MessageEvent(type, {\n          data: data.slice(0, -1), // remove trailing newline\n          lastEventId: lastEventId,\n          origin: new URL(url).origin\n        }))\n        data = ''\n      }\n      eventName = void 0\n    } else if (fieldLength > 0) {\n      var noValue = fieldLength < 0\n      var step = 0\n      var field = buf.slice(pos, pos + (noValue ? lineLength : fieldLength)).toString()\n\n      if (noValue) {\n        step = lineLength\n      } else if (buf[pos + fieldLength + 1] !== space) {\n        step = fieldLength + 1\n      } else {\n        step = fieldLength + 2\n      }\n      pos += step\n\n      var valueLength = lineLength - step\n      var value = buf.slice(pos, pos + valueLength).toString()\n\n      if (field === 'data') {\n        data += value + '\\n'\n      } else if (field === 'event') {\n        eventName = value\n      } else if (field === 'id') {\n        lastEventId = value\n      } else if (field === 'retry') {\n        var retry = parseInt(value, 10)\n        if (!Number.isNaN(retry)) {\n          self.reconnectInterval = retry\n        }\n      }\n    }\n  }\n}\n\nmodule.exports = EventSource\n\nutil.inherits(EventSource, events.EventEmitter)\nEventSource.prototype.constructor = EventSource; // make stacktraces readable\n\n['open', 'error', 'message'].forEach(function (method) {\n  Object.defineProperty(EventSource.prototype, 'on' + method, {\n    /**\n     * Returns the current listener\n     *\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    get: function get () {\n      var listener = this.listeners(method)[0]\n      return listener ? (listener._listener ? listener._listener : listener) : undefined\n    },\n\n    /**\n     * Start listening for events\n     *\n     * @param {Function} listener the listener\n     * @return {Mixed} the set function or undefined\n     * @api private\n     */\n    set: function set (listener) {\n      this.removeAllListeners(method)\n      this.addEventListener(method, listener)\n    }\n  })\n})\n\n/**\n * Ready states\n */\nObject.defineProperty(EventSource, 'CONNECTING', {enumerable: true, value: 0})\nObject.defineProperty(EventSource, 'OPEN', {enumerable: true, value: 1})\nObject.defineProperty(EventSource, 'CLOSED', {enumerable: true, value: 2})\n\nEventSource.prototype.CONNECTING = 0\nEventSource.prototype.OPEN = 1\nEventSource.prototype.CLOSED = 2\n\n/**\n * Closes the connection, if one is made, and sets the readyState attribute to 2 (closed)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventSource/close\n * @api public\n */\nEventSource.prototype.close = function () {\n  this._close()\n}\n\n/**\n * Emulates the W3C Browser based WebSocket interface using addEventListener.\n *\n * @param {String} type A string representing the event type to listen out for\n * @param {Function} listener callback\n * @see https://developer.mozilla.org/en/DOM/element.addEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nEventSource.prototype.addEventListener = function addEventListener (type, listener) {\n  if (typeof listener === 'function') {\n    // store a reference so we can return the original function again\n    listener._listener = listener\n    this.on(type, listener)\n  }\n}\n\n/**\n * Emulates the W3C Browser based WebSocket interface using dispatchEvent.\n *\n * @param {Event} event An event to be dispatched\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n * @api public\n */\nEventSource.prototype.dispatchEvent = function dispatchEvent (event) {\n  if (!event.type) {\n    throw new Error('UNSPECIFIED_EVENT_TYPE_ERR')\n  }\n  // if event is instance of an CustomEvent (or has 'details' property),\n  // send the detail object as the payload for the event\n  this.emit(event.type, event.detail)\n}\n\n/**\n * Emulates the W3C Browser based WebSocket interface using removeEventListener.\n *\n * @param {String} type A string representing the event type to remove\n * @param {Function} listener callback\n * @see https://developer.mozilla.org/en/DOM/element.removeEventListener\n * @see http://dev.w3.org/html5/websockets/#the-websocket-interface\n * @api public\n */\nEventSource.prototype.removeEventListener = function removeEventListener (type, listener) {\n  if (typeof listener === 'function') {\n    listener._listener = undefined\n    this.removeListener(type, listener)\n  }\n}\n\n/**\n * W3C Event\n *\n * @see http://www.w3.org/TR/DOM-Level-3-Events/#interface-Event\n * @api private\n */\nfunction Event (type, optionalProperties) {\n  Object.defineProperty(this, 'type', { writable: false, value: type, enumerable: true })\n  if (optionalProperties) {\n    for (var f in optionalProperties) {\n      if (optionalProperties.hasOwnProperty(f)) {\n        Object.defineProperty(this, f, { writable: false, value: optionalProperties[f], enumerable: true })\n      }\n    }\n  }\n}\n\n/**\n * W3C MessageEvent\n *\n * @see http://www.w3.org/TR/webmessaging/#event-definitions\n * @api private\n */\nfunction MessageEvent (type, eventInitDict) {\n  Object.defineProperty(this, 'type', { writable: false, value: type, enumerable: true })\n  for (var f in eventInitDict) {\n    if (eventInitDict.hasOwnProperty(f)) {\n      Object.defineProperty(this, f, { writable: false, value: eventInitDict[f], enumerable: true })\n    }\n  }\n}\n\n/**\n * Returns a new object of headers that does not include any authorization and cookie headers\n *\n * @param {Object} headers An object of headers ({[headerName]: headerValue})\n * @return {Object} a new object of headers\n * @api private\n */\nfunction removeUnsafeHeaders (headers) {\n  var safe = {}\n  for (var key in headers) {\n    if (reUnsafeHeader.test(key)) {\n      continue\n    }\n\n    safe[key] = headers[key]\n  }\n\n  return safe\n}\n"]},"metadata":{},"sourceType":"script"}