{"ast":null,"code":"import axios from \"axios\";\nimport env from \"common/enviroment\";\nimport { createBaseHttpRequestBody } from \"axios/AxiosUtils\";\nimport { isEmpty } from \"./utils/collections\";\nimport axiosRetry from 'axios-retry';\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\nimport { getRetryConfig } from \"axios/AxiosUtils\";\nimport { LOGIN } from \"axios/AxiosUtils\";\nconst SEPARATOR = ',';\nconst VISIBILITY_GROUPS = 'visibility_groups';\nconst USER_LOGIN = 'user';\nconst USER_ID = 'user_id';\nconst USER_NAME = 'user_name';\nconst USER_REGISTRATION_ID = 'user_registration_id';\nconst ROLE = 'role';\nconst LDAP_ROLES = 'ldap_roles';\nconst JWT = 'token';\nconst CORTEX_TOKEN = 'cortex_token';\nconst LAST_WARNING_ID = 'lastWarningId';\nconst VIEWED_WARNINGS = 'viewedWarnings';\nconst CURRENT_SERVER = \"current_server\";\nconst NEAR_CLOSING_WARNING_MODAL = 'nearClosingWarningModal';\nconst PENDING_HOMOLOGATION_WARNING_MODAL = 'pendingHomologationWarningModal';\nconst MONITORING_CHIEF = 'monitoramentoChief';\nexport const ADMIN = 'admin';\nexport function getVisibilityGroups() {\n  if (localStorage.getItem(VISIBILITY_GROUPS)) return localStorage.getItem(VISIBILITY_GROUPS).split(SEPARATOR);\n  return [];\n}\nexport function setVisibilityGroups(groups) {\n  if (groups) {\n    localStorage.setItem(VISIBILITY_GROUPS, groups.join(SEPARATOR));\n  }\n}\nexport function getUserLogin() {\n  if (localStorage.getItem(USER_LOGIN)) return localStorage.getItem(USER_LOGIN);\n  return \"\";\n}\nexport function setUserLogin(userLogin) {\n  localStorage.setItem(USER_LOGIN, userLogin);\n}\nexport function getUserID() {\n  if (localStorage.getItem(USER_ID)) return localStorage.getItem(USER_ID);\n  return \"\";\n}\nexport function setUserID(userID) {\n  localStorage.setItem(USER_ID, userID);\n}\nexport function getUserRegistrationID() {\n  if (localStorage.getItem(USER_REGISTRATION_ID)) return localStorage.getItem(USER_REGISTRATION_ID);\n  return \"\";\n}\nexport function setUserRegistrationID(userRegistrationID) {\n  localStorage.setItem(USER_REGISTRATION_ID, userRegistrationID);\n}\nexport function setUserName(userName) {\n  localStorage.setItem(USER_NAME, userName);\n}\nexport function getUserName() {\n  if (localStorage.getItem(USER_NAME)) return localStorage.getItem(USER_NAME);\n  return \"\";\n}\nexport function getUserData() {\n  let data = {\n    'user_id': getUserID(),\n    'user_name': getUserName(),\n    'user_login': getUserLogin(),\n    'user_registration_id': getUserRegistrationID()\n  };\n  return data;\n}\nexport function setNotification(notification) {\n  sessionStorage.setItem('warning', JSON.stringify(notification));\n}\nexport function setNotificationHistory(historyData) {\n  sessionStorage.setItem('historyData', JSON.stringify(historyData));\n}\nexport function setWarningConfigHistory(historyData) {\n  sessionStorage.setItem('historyData', JSON.stringify(historyData));\n}\nexport function getNotification() {\n  if (sessionStorage.getItem('warning')) return JSON.parse(sessionStorage.getItem('warning'));\n  return \"\";\n}\nexport function getNotificationHistory() {\n  if (sessionStorage.getItem('historyData')) return JSON.parse(sessionStorage.getItem('historyData'));\n  return \"\";\n}\nexport function getWarningConfigHistory() {\n  if (sessionStorage.getItem('historyData')) return JSON.parse(sessionStorage.getItem('historyData'));\n  return \"\";\n}\nexport function hasUserLoggedData() {\n  return !isEmpty(getUserName());\n}\nexport function getUserRole() {\n  if (localStorage.getItem(ROLE)) return localStorage.getItem(ROLE).toUpperCase();\n  return \"\";\n}\nexport function setUserRole(role) {\n  localStorage.setItem(ROLE, role);\n}\nexport function getLDAPRoles() {\n  if (localStorage.getItem(LDAP_ROLES)) return localStorage.getItem(LDAP_ROLES).split(SEPARATOR);\n  return \"\";\n}\nexport function setLDAPRoles(ldapRoles) {\n  localStorage.setItem(LDAP_ROLES, ldapRoles.join(SEPARATOR));\n}\nexport function getJWT() {\n  if (localStorage.getItem(JWT)) return localStorage.getItem(JWT);\n  return \"\";\n}\nexport function setJWT(token) {\n  localStorage.setItem(JWT, token);\n}\nexport function setMonitoringChiefFlag(value) {\n  localStorage.setItem(MONITORING_CHIEF, value);\n}\nexport function isMonitoringChief() {\n  if (localStorage.getItem(MONITORING_CHIEF)) return localStorage.getItem(MONITORING_CHIEF);\n  return false;\n}\nexport function getCortexToken() {\n  if (localStorage.getItem(CORTEX_TOKEN)) return localStorage.getItem(CORTEX_TOKEN);\n  return \"\";\n}\nexport function setCortexToken(token) {\n  localStorage.setItem(CORTEX_TOKEN, token);\n}\nexport function getLastWarningID() {\n  return localStorage.getItem(LAST_WARNING_ID);\n}\nexport function setLastWarningId(lastWarningId) {\n  localStorage.setItem(LAST_WARNING_ID, lastWarningId);\n}\nexport function getCurrentServer() {\n  if (localStorage.getItem(CURRENT_SERVER)) return localStorage.getItem(CURRENT_SERVER);\n  return '1';\n}\nexport function setCurrentServer(currentServer) {\n  localStorage.setItem(CURRENT_SERVER, currentServer);\n}\nexport function getViewedWarnings() {\n  if (localStorage.getItem(VIEWED_WARNINGS)) return localStorage.getItem(VIEWED_WARNINGS);\n  return \"\";\n}\nexport function setViewedWarnings(viewedWarnings) {\n  localStorage.setItem(VIEWED_WARNINGS, viewedWarnings);\n}\nexport function isNearClosingWarningModalEnabled() {\n  if (localStorage.getItem(NEAR_CLOSING_WARNING_MODAL)) return localStorage.getItem(NEAR_CLOSING_WARNING_MODAL) === \"true\";\n  return false;\n}\nexport function setNearClosingWarningModalEnabled(nearClosingWarningModal) {\n  localStorage.setItem(NEAR_CLOSING_WARNING_MODAL, nearClosingWarningModal);\n}\nexport function isPendingHomologationModalEnabled() {\n  if (localStorage.getItem(PENDING_HOMOLOGATION_WARNING_MODAL)) return localStorage.getItem(PENDING_HOMOLOGATION_WARNING_MODAL) === \"true\";\n  return false;\n}\nexport function setPendingHomologationModalEnabled(pending) {\n  localStorage.setItem(PENDING_HOMOLOGATION_WARNING_MODAL, pending);\n}\nexport function isLoggedIn() {\n  const jwtToken = localStorage.getItem(JWT);\n\n  if (jwtToken) {\n    const tokenParts = jwtToken.split('.');\n\n    if (tokenParts.length === 3) {\n      const payload = JSON.parse(Buffer.from(tokenParts[1], 'base64').toString('utf8'));\n      const currentTime = Math.floor(Date.now() / 1000);\n\n      if (payload.exp > currentTime) {\n        return localStorage.getItem(USER_LOGIN) && localStorage.getItem(ROLE) && localStorage.getItem(VISIBILITY_GROUPS);\n      } else {\n        cleanSession();\n        window.location.href = '/login';\n        return false;\n      }\n    }\n  }\n\n  return false;\n}\nexport function isAdmin() {\n  return getUserRole() === \"ADMIN\";\n}\nexport function isCOE() {\n  return getLDAPRoles().includes(\"COE\");\n}\nexport function isExternalUser() {\n  return isGaeco() || isDNIT() || isPRF();\n}\nexport function isGaeco() {\n  return getUserRole() === \"GAECO\";\n}\nexport function isPRF() {\n  return getUserRole() === \"PRF\";\n} //TODO: Incorporar estas funcionalidades como uma única. Isto é juntar o tratamento de GAECO e do DNIT e qualquer outro da mesma forma. \n\nexport function isDNIT() {\n  return getUserRole() === \"DNIT\";\n}\nexport function isSubgerente() {\n  let managers = ['SUBGERENTE', 'GERENTE', 'COE', 'GOFMT', 'GECOF', 'GOAC', 'ATIF'];\n  return managers.includes(getUserRole());\n}\nexport function isMonitoramento() {\n  return getUserRole() === \"MONITORAMENTO\";\n}\nexport function isComandoFiscal() {\n  return getUserRole() === \"COMANDO\" || getUserRole() === \"OPERACIONAL\" || getUserRole() === \"COMANDOFISCAL\";\n}\nexport function cleanSession() {\n  localStorage.removeItem(USER_LOGIN);\n  localStorage.removeItem(USER_ID);\n  localStorage.removeItem(USER_NAME);\n  localStorage.removeItem(USER_REGISTRATION_ID);\n  localStorage.removeItem(JWT);\n  localStorage.removeItem(CORTEX_TOKEN);\n  localStorage.removeItem(ROLE);\n  localStorage.removeItem(LDAP_ROLES);\n  localStorage.removeItem(VISIBILITY_GROUPS);\n  localStorage.removeItem(LAST_WARNING_ID);\n  localStorage.removeItem(VIEWED_WARNINGS);\n  localStorage.removeItem(MONITORING_CHIEF);\n}\nexport function reloadVisibilityGroups() {\n  const configAxios = axios.create(getTimeoutConfig(LOGIN));\n  axiosRetry(configAxios, getRetryConfig());\n  const httpHeader = createBaseHttpRequestBody();\n  httpHeader['user_login'] = localStorage.getItem(USER_LOGIN);\n  let visibilityGroups = getVisibilityGroups();\n  axios.post(\"\".concat(env.apiAddress, \"/auditor/read\"), httpHeader).then(res => {\n    let data = res.data[0];\n\n    if (data['user_id']) {\n      let groups = data['usuario_grupo']; //Só inclui grupos novos que ainda não estavam no visibilityGroups\n\n      for (const group of groups) {\n        if (!visibilityGroups.includes(group['group_id'])) {\n          visibilityGroups.push(group['group_id']);\n        }\n      }\n    }\n\n    return true;\n  }).catch(err => {\n    console.log(err);\n    return true;\n  }).finally(() => {\n    setVisibilityGroups(visibilityGroups);\n  });\n}","map":{"version":3,"sources":["C:/aria/cicc-app/front-end/src/common/SessionUtils.js"],"names":["axios","env","createBaseHttpRequestBody","isEmpty","axiosRetry","getTimeoutConfig","getRetryConfig","LOGIN","SEPARATOR","VISIBILITY_GROUPS","USER_LOGIN","USER_ID","USER_NAME","USER_REGISTRATION_ID","ROLE","LDAP_ROLES","JWT","CORTEX_TOKEN","LAST_WARNING_ID","VIEWED_WARNINGS","CURRENT_SERVER","NEAR_CLOSING_WARNING_MODAL","PENDING_HOMOLOGATION_WARNING_MODAL","MONITORING_CHIEF","ADMIN","getVisibilityGroups","localStorage","getItem","split","setVisibilityGroups","groups","setItem","join","getUserLogin","setUserLogin","userLogin","getUserID","setUserID","userID","getUserRegistrationID","setUserRegistrationID","userRegistrationID","setUserName","userName","getUserName","getUserData","data","setNotification","notification","sessionStorage","JSON","stringify","setNotificationHistory","historyData","setWarningConfigHistory","getNotification","parse","getNotificationHistory","getWarningConfigHistory","hasUserLoggedData","getUserRole","toUpperCase","setUserRole","role","getLDAPRoles","setLDAPRoles","ldapRoles","getJWT","setJWT","token","setMonitoringChiefFlag","value","isMonitoringChief","getCortexToken","setCortexToken","getLastWarningID","setLastWarningId","lastWarningId","getCurrentServer","setCurrentServer","currentServer","getViewedWarnings","setViewedWarnings","viewedWarnings","isNearClosingWarningModalEnabled","setNearClosingWarningModalEnabled","nearClosingWarningModal","isPendingHomologationModalEnabled","setPendingHomologationModalEnabled","pending","isLoggedIn","jwtToken","tokenParts","length","payload","Buffer","from","toString","currentTime","Math","floor","Date","now","exp","cleanSession","window","location","href","isAdmin","isCOE","includes","isExternalUser","isGaeco","isDNIT","isPRF","isSubgerente","managers","isMonitoramento","isComandoFiscal","removeItem","reloadVisibilityGroups","configAxios","create","httpHeader","visibilityGroups","post","apiAddress","then","res","group","push","catch","err","console","log","finally"],"mappings":"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","sourcesContent":["\r\nimport axios from \"axios\";\r\nimport env from \"common/enviroment\";\r\nimport { createBaseHttpRequestBody } from \"axios/AxiosUtils\";\r\nimport { isEmpty } from \"./utils/collections\";\r\nimport axiosRetry from 'axios-retry';\r\nimport { getTimeoutConfig } from \"axios/AxiosUtils\";\r\nimport { getRetryConfig } from \"axios/AxiosUtils\";\r\nimport { LOGIN } from \"axios/AxiosUtils\";\r\n\r\n  const SEPARATOR = ',';\r\n  const VISIBILITY_GROUPS = 'visibility_groups';\r\n  const USER_LOGIN = 'user';\r\n  const USER_ID = 'user_id';\r\n  const USER_NAME = 'user_name';\r\n  const USER_REGISTRATION_ID = 'user_registration_id';\r\n  const ROLE = 'role';\r\n  const LDAP_ROLES = 'ldap_roles';\r\n  const JWT = 'token';\r\n  const CORTEX_TOKEN = 'cortex_token'\r\n  const LAST_WARNING_ID = 'lastWarningId';\r\n  const VIEWED_WARNINGS = 'viewedWarnings'\r\n  const CURRENT_SERVER = \"current_server\"\r\n  const NEAR_CLOSING_WARNING_MODAL = 'nearClosingWarningModal'\r\n  const PENDING_HOMOLOGATION_WARNING_MODAL = 'pendingHomologationWarningModal'\r\n  const MONITORING_CHIEF = 'monitoramentoChief'\r\n\r\n  export const ADMIN = 'admin'\r\n  \r\n  export function getVisibilityGroups() {\r\n    if (localStorage.getItem(VISIBILITY_GROUPS)) \r\n      return localStorage.getItem(VISIBILITY_GROUPS).split(SEPARATOR)\r\n    return []\r\n  }\r\n\r\n  export function setVisibilityGroups(groups) {\r\n    if (groups) {\r\n      localStorage.setItem(VISIBILITY_GROUPS, groups.join(SEPARATOR))       \r\n    }\r\n  }\r\n  \r\n  export function getUserLogin() {\r\n    if (localStorage.getItem(USER_LOGIN)) \r\n      return localStorage.getItem(USER_LOGIN)\r\n    return \"\"\r\n  }\r\n\r\n  export function setUserLogin(userLogin)  {\r\n    localStorage.setItem(USER_LOGIN, userLogin)       \r\n  }\r\n  \r\n  export function getUserID() {\r\n    if (localStorage.getItem(USER_ID)) \r\n      return localStorage.getItem(USER_ID)\r\n    return \"\"\r\n  }\r\n\r\n  export function setUserID(userID) {\r\n    localStorage.setItem(USER_ID, userID)       \r\n  }\r\n\r\n  export function getUserRegistrationID() {\r\n    if (localStorage.getItem(USER_REGISTRATION_ID)) \r\n      return localStorage.getItem(USER_REGISTRATION_ID)\r\n    return \"\"\r\n  }\r\n\r\n  export function setUserRegistrationID(userRegistrationID) {\r\n    localStorage.setItem(USER_REGISTRATION_ID, userRegistrationID)       \r\n  }\r\n\r\n  export function setUserName(userName) {\r\n    localStorage.setItem(USER_NAME, userName)       \r\n  }\r\n\r\n  export function getUserName() {\r\n    if (localStorage.getItem(USER_NAME)) \r\n      return localStorage.getItem(USER_NAME)\r\n    return \"\"    \r\n  }\r\n\r\n  export function getUserData(){\r\n    let data = {\r\n      'user_id' : getUserID(),\r\n      'user_name' : getUserName(),\r\n      'user_login' : getUserLogin(),\r\n      'user_registration_id' : getUserRegistrationID()\r\n    }\r\n    return data\r\n  }\r\n\r\n\r\n  export function setNotification(notification){\r\n    sessionStorage.setItem('warning',JSON.stringify(notification));\r\n  }\r\n\r\n  export function setNotificationHistory(historyData){\r\n    sessionStorage.setItem('historyData',JSON.stringify(historyData));  \r\n  }\r\n\r\n  export function setWarningConfigHistory(historyData){\r\n    sessionStorage.setItem('historyData',JSON.stringify(historyData));  \r\n  }\r\n\r\n  \r\n  export function getNotification(){\r\n    if (sessionStorage.getItem('warning'))  \r\n      return JSON.parse(sessionStorage.getItem('warning'));\r\n    return \"\"\r\n  }\r\n\r\n  export function getNotificationHistory(){\r\n    if (sessionStorage.getItem('historyData'))  \r\n      return JSON.parse(sessionStorage.getItem('historyData'));\r\n    return \"\"\r\n  }\r\n\r\n  export function getWarningConfigHistory(){\r\n    if (sessionStorage.getItem('historyData'))  \r\n      return JSON.parse(sessionStorage.getItem('historyData'));\r\n    return \"\"\r\n  }\r\n    \r\n\r\n  export function hasUserLoggedData() {\r\n    return !isEmpty(getUserName())    \r\n  }\r\n\r\n  export function getUserRole() {\r\n    if (localStorage.getItem(ROLE)) \r\n      return localStorage.getItem(ROLE).toUpperCase()\r\n    return \"\"\r\n  }\r\n\r\n  export function setUserRole(role) {\r\n    localStorage.setItem(ROLE, role)       \r\n  }\r\n\r\n  export function getLDAPRoles() {\r\n    if (localStorage.getItem(LDAP_ROLES)) \r\n      return localStorage.getItem(LDAP_ROLES).split(SEPARATOR)\r\n    return \"\"\r\n  }\r\n\r\n  export function setLDAPRoles(ldapRoles) {\r\n    localStorage.setItem(LDAP_ROLES, ldapRoles.join(SEPARATOR))       \r\n  }\r\n\r\n  export function getJWT() {\r\n    if (localStorage.getItem(JWT)) \r\n      return localStorage.getItem(JWT)\r\n    return \"\"\r\n  }\r\n\r\n  export function setJWT(token) {\r\n    localStorage.setItem(JWT, token)       \r\n  }\r\n\r\n  export function setMonitoringChiefFlag(value){\r\n    localStorage.setItem(MONITORING_CHIEF, value)       \r\n  }\r\n\r\n  export function isMonitoringChief(){\r\n    if (localStorage.getItem(MONITORING_CHIEF)) \r\n      return localStorage.getItem(MONITORING_CHIEF)\r\n    return false    \r\n  }\r\n\r\n\r\n  export function getCortexToken() {\r\n    if (localStorage.getItem(CORTEX_TOKEN)) \r\n      return localStorage.getItem(CORTEX_TOKEN)\r\n    return \"\"\r\n  }\r\n\r\n  export function setCortexToken(token) {\r\n    localStorage.setItem(CORTEX_TOKEN, token)       \r\n  }\r\n\r\n  export function getLastWarningID() {\r\n    return localStorage.getItem(LAST_WARNING_ID)    \r\n  }\r\n\r\n  export function setLastWarningId(lastWarningId) {\r\n    localStorage.setItem(LAST_WARNING_ID, lastWarningId)       \r\n  }\r\n\r\n  export function getCurrentServer() {\r\n    if (localStorage.getItem(CURRENT_SERVER)) \r\n      return localStorage.getItem(CURRENT_SERVER)    \r\n    return '1'\r\n  }\r\n\r\n  export function setCurrentServer(currentServer) {\r\n    localStorage.setItem(CURRENT_SERVER, currentServer)       \r\n  }\r\n\r\n  export function getViewedWarnings() {\r\n    if (localStorage.getItem(VIEWED_WARNINGS)) \r\n      return localStorage.getItem(VIEWED_WARNINGS)\r\n    return \"\"\r\n  }\r\n\r\n  export function setViewedWarnings(viewedWarnings) {\r\n    localStorage.setItem(VIEWED_WARNINGS, viewedWarnings)       \r\n  }\r\n\r\n  \r\n  export function isNearClosingWarningModalEnabled() {\r\n    if (localStorage.getItem(NEAR_CLOSING_WARNING_MODAL)) \r\n      return localStorage.getItem(NEAR_CLOSING_WARNING_MODAL) === \"true\"\r\n    return false\r\n  }\r\n\r\n  export function setNearClosingWarningModalEnabled(nearClosingWarningModal) {\r\n    localStorage.setItem(NEAR_CLOSING_WARNING_MODAL, nearClosingWarningModal)       \r\n  }\r\n\r\n  export function isPendingHomologationModalEnabled() {\r\n    if (localStorage.getItem(PENDING_HOMOLOGATION_WARNING_MODAL))\r\n      return localStorage.getItem(PENDING_HOMOLOGATION_WARNING_MODAL) === \"true\"\r\n    return false\r\n  }\r\n\r\n  export function setPendingHomologationModalEnabled(pending){\r\n    localStorage.setItem(PENDING_HOMOLOGATION_WARNING_MODAL, pending);\r\n  }\r\n  \r\n\r\n  export function isLoggedIn() {\r\n    const jwtToken = localStorage.getItem(JWT);\r\n    if(jwtToken){\r\n      const tokenParts = jwtToken.split('.');\r\n      if(tokenParts.length===3){\r\n        const payload = JSON.parse(\r\n          Buffer.from(tokenParts[1], 'base64').toString('utf8')\r\n        );\r\n        \r\n        const currentTime = Math.floor(Date.now() / 1000);\r\n        if(payload.exp > currentTime) {\r\n          return (\r\n            localStorage.getItem(USER_LOGIN) &&\r\n            localStorage.getItem(ROLE) &&\r\n            localStorage.getItem(VISIBILITY_GROUPS)\r\n          );\r\n        } else {\r\n          cleanSession();\r\n          window.location.href = '/login';\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  \r\n  export function isAdmin() {\r\n    return  (getUserRole() === \"ADMIN\") \r\n  }\r\n\r\n\r\n  export function isCOE() {\r\n    return  getLDAPRoles().includes(\"COE\") \r\n  }\r\n\r\n  export function isExternalUser() {\r\n    return  (isGaeco() || isDNIT() || isPRF())\r\n  }\r\n  \r\n  export function isGaeco() {\r\n    return  (getUserRole() === \"GAECO\") \r\n  }\r\n\r\n  export function isPRF() {\r\n    return  (getUserRole() === \"PRF\") \r\n  }\r\n  \r\n  //TODO: Incorporar estas funcionalidades como uma única. Isto é juntar o tratamento de GAECO e do DNIT e qualquer outro da mesma forma. \r\n  export function isDNIT() {\r\n    return  (getUserRole() === \"DNIT\") \r\n  }\r\n  \r\n  export function isSubgerente() {\r\n    let managers =  ['SUBGERENTE', 'GERENTE', 'COE', 'GOFMT', 'GECOF', 'GOAC', 'ATIF']\r\n    return  managers.includes(getUserRole())\r\n  }\r\n\r\n  export function isMonitoramento() {\r\n    return  (getUserRole() === \"MONITORAMENTO\") \r\n  }\r\n\r\n  export function isComandoFiscal() {\r\n    return  (getUserRole() === \"COMANDO\"  || getUserRole() === \"OPERACIONAL\" || getUserRole() === \"COMANDOFISCAL\" ) \r\n  }\r\n  \r\n  export function cleanSession() {\r\n\r\n    localStorage.removeItem(USER_LOGIN)\r\n    localStorage.removeItem(USER_ID)\r\n    localStorage.removeItem(USER_NAME)\r\n    localStorage.removeItem(USER_REGISTRATION_ID)\r\n    localStorage.removeItem(JWT)\r\n    localStorage.removeItem(CORTEX_TOKEN)\r\n    localStorage.removeItem(ROLE)\r\n    localStorage.removeItem(LDAP_ROLES)\r\n    localStorage.removeItem(VISIBILITY_GROUPS)\r\n    localStorage.removeItem(LAST_WARNING_ID)    \r\n    localStorage.removeItem(VIEWED_WARNINGS)\r\n    localStorage.removeItem(MONITORING_CHIEF)\r\n  }\r\n\r\n  export function reloadVisibilityGroups() {\r\n    \r\n    const configAxios = axios.create(getTimeoutConfig(LOGIN))\r\n    axiosRetry(configAxios, getRetryConfig())\r\n  \r\n    const httpHeader = createBaseHttpRequestBody()\r\n    httpHeader['user_login'] = localStorage.getItem(USER_LOGIN)\r\n    \r\n    let visibilityGroups = getVisibilityGroups()\r\n\r\n    axios.post(`${env.apiAddress}/auditor/read`, httpHeader).then(res => {\r\n      \r\n      let data = res.data[0]\r\n      \r\n      if (data['user_id']) {\r\n  \r\n        let groups = data['usuario_grupo']\r\n        \r\n        //Só inclui grupos novos que ainda não estavam no visibilityGroups\r\n        for (const group of groups) {            \r\n          if (!visibilityGroups.includes(group['group_id'])) {\r\n            visibilityGroups.push(group['group_id'])\r\n          }\r\n        }\r\n      }\r\n      return true\r\n    }).catch(err => {\r\n      console.log(err)\r\n      return true \r\n    }).finally(() => {\r\n      setVisibilityGroups(visibilityGroups)\r\n    })\r\n  \r\n  }\r\n    \r\n    \r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}